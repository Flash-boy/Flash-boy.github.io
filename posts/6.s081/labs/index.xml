<?xml version="1.0" encoding="utf-8" standalone="yes"?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom">
  <channel>
    <title>Yang Wei</title>
    <link>https://flash-boy.github.io/posts/6.s081/labs/</link>
    <description>Recent content on Yang Wei</description>
    <generator>Hugo -- gohugo.io</generator>
    <language>en</language>
    <lastBuildDate>Sun, 05 Jun 2022 00:00:00 +0000</lastBuildDate><atom:link href="https://flash-boy.github.io/posts/6.s081/labs/index.xml" rel="self" type="application/rss+xml" />
    <item>
      <title>Lab0 ç¯å¢ƒæ­å»º</title>
      <link>https://flash-boy.github.io/posts/6.s081/labs/lab0/</link>
      <pubDate>Sun, 05 Jun 2022 00:00:00 +0000</pubDate>
      
      <guid>https://flash-boy.github.io/posts/6.s081/labs/lab0/</guid>
      <description>ç¯å¢ƒæ­å»ºå†™åœ¨å‰é¢è¦å®Œæˆè¯¾ç¨‹å®éªŒï¼Œå¸Œæœ›ä½ å¯ä»¥ä¸»åŠ¨å»å­¦ä¹ ä¸€äº›å·¥å…·çš„ä½¿ç”¨ï¼Œå°†æœ‰åŠ©äºé«˜æ•ˆå®Œæˆæ•´ä¸ªå®éªŒï¼Œè¿™äº›å·¥å…·ä¹Ÿæ˜¯ä½œä¸ºä¸€ä¸ªlinuxç³»ç»Ÿå¼€å‘äººå‘˜å¿…å¤‡çš„çŸ¥è¯†ï¼Œæˆ‘è‡ªå·±å¸¸ç”¨çš„å·¥å…·ä¸»è¦æœ‰ä»¥ä¸‹å‡ ä¸ªï¼š
tmuxï¼šç»ˆç«¯å¤ç”¨å·¥å…· vimï¼šä»£ç ç¼–è¾‘å™¨ gitï¼šç‰ˆæœ¬æ§åˆ¶å·¥å…· gdbï¼šä»£ç è°ƒè¯•å™¨ tmuxï¼šåšæ•´ä¸ªå®éªŒï¼Œæˆ‘ä»¬å¿…ç„¶éœ€è¦æ‰“å¼€å¤šä¸ªæ–‡ä»¶ï¼ŒæŸ¥çœ‹å¤šä¸ªxv6å†…æ ¸çš„æºç ï¼Œtmuxå¯ä»¥å¸®ä½æˆ‘ä»¬åŒæ—¶æ‰“å¼€å¤šä¸ªçª—å£ï¼Œå¹¶ä¸”åœ¨å¤šä¸ªçª—å£æ¥å›åˆ‡æ¢ã€‚ç›¸ä¿¡æˆ‘çœŸçš„ç‰¹åˆ«å¥½ç”¨ã€‚ğŸ˜‰
vimï¼šlinuxè‡ªå¸¦çš„ä»£ç ç¼–è¾‘å™¨ï¼Œä¸å¿…å¤šè¯´ï¼Œå–œæ¬¢çš„å–œæ¬¢ä¸å¾—äº†ï¼Œä¸ç”¨çš„å«Œéº»çƒ¦ï¼Œæˆ‘è§‰å¾—è¿˜æ˜¯å¾ˆæœ‰å¿…è¦å»å­¦ä¹ çš„ã€‚vimæ˜¯å­¦ä¹ æˆæœ¬æ¯”è¾ƒé«˜çš„ï¼Œå­¦ä¹ è·¯çº¿æ¯”è¾ƒé™¡å³­ï¼Œå­¦åˆ°æ‰‹æ”¶ç›Šä¹Ÿæ˜¯å¾ˆå¤§çš„ã€‚
gitï¼šæ¯ä¸ªå¼€å‘äººå‘˜éƒ½åº”è¯¥æŒæ¡çš„ä»£ç ç®¡ç†å·¥å…·ï¼Œå­¦ä¹ gitä¸ä»…ä»…æ˜¯å­¦ä¹ å‘½ä»¤çš„ä½¿ç”¨ï¼Œæ›´åº”è¯¥å­¦ä¹ å®ƒçš„åº•å±‚å®éªŒåŸç†ï¼Œè¿™æ ·ä¼šæ›´åŠ ç†è§£æ¯ä¸ªå‘½ä»¤çš„å®é™…ä½œç”¨ã€‚
gdbï¼šlinuxä¸‹çš„ä»£ç è°ƒè¯•å·¥å…·ï¼Œæ˜¯çœŸçš„å¥½ç”¨ï¼Œä¹Ÿæ˜¯è¯¥è¯¾ç¨‹çš„è°ƒè¯•å·¥å…·ã€‚
å¯èƒ½ä»¥ä¸Šå·¥å…·è§‰å¾—æœ‰ç‚¹æ‚ï¼Œä½†æ˜¯æœ‰ä¸€é—¨ç”±MITåŠ©æ•™å‘èµ·çš„è¯¾ç¨‹ï¼Œå«åšè®¡ç®—æœºæ•™è‚²ä¸­ç¼ºå¤±çš„ä¸€è¯¾ã€‚è¯¥è¯¾ç¨‹ä¸é•¿10ä¸ªå°æ—¶å·¦å³ï¼Œå°±ä»‹ç»äº†ä¸Šè¿°çš„å„ç§å·¥å…·ï¼Œå¼ºçƒˆå»ºè®®å¯ä»¥å»å­¦ä¹ ä¸€ä¸‹ï¼Œå¯¹äºå·¥ä½œå¼€å‘ååˆ†æœ‰ç”¨ï¼Œè¿™é‡Œæ˜¯è¯¥è¯¾çš„è¯¾ç¨‹ä¸»é¡µå’Œè§†é¢‘èµ„æºï¼ŒBç«™ï¼Œyoutubeã€‚
é€šè¿‡è®¡ç®—æœºæ•™è‚²ä¸­ç¼ºå¤±çš„ä¸€è¯¾æˆ‘è¿˜å­¦ä¹ åˆ°äº†ä¸€ä¸ªå¾ˆé‡è¦çš„å·¥å…·dotfilesï¼Œå¦‚ä½•ç®¡ç†ä½ çš„æ¯ä¸ªå·¥å…·çš„é…ç½®æ–‡ä»¶ï¼Œå½“ä½ åœ¨åˆ‡æ¢å·¥ä½œæœºå™¨æˆ–è€…ç”µè„‘æ—¶ï¼Œèƒ½å¾ˆæ–¹ä¾¿çš„é…ç½®ä½ çš„è®¡ç®—æœºï¼Œå®šåˆ¶åŒ–ä½ çš„é…ç½®ï¼ŒåŒ…æ‹¬shellã€vimã€tmuxã€gitç­‰ã€‚è¿™é—¨è¯¾çš„ä¸»è®²äººä¹‹ä¸€Anish Athalyeå¼€å‘äº†ä¸€ä¸ªdotbot,å¯ä»¥å¾ˆæ–¹ä¾¿çš„ç®¡ç†ä½ çš„dotfilesã€‚æˆ‘å‚è€ƒä»–çš„dotfilesç¼–å†™äº†è‡ªå·±çš„dotfiles,æœ‰éœ€è¦çš„è‡ªå–^_^ã€‚
å½“ç„¶ï¼Œä¹Ÿå¸Œæœ›ä½ ç›®å‰èƒ½å¤Ÿç¿»å¢™ï¼Œå› ä¸ºè¿™æœ‰åŠ©äºä½ åœ¨linuxä¸‹ä¸‹è½½æŸäº›è½¯ä»¶åŒ…æ—¶ä¸ä¼šå› ä¸ºç½‘ç»œåŸå› æ— æ³•æˆåŠŸã€‚æ‡‚çš„éƒ½æ‡‚ ğŸ˜
å®˜æ–¹æŒ‡å¯¼é…ç½®ç¯å¢ƒå®˜æ–¹ç»™å‡ºäº†ä¸åŒæœºå™¨çš„é…ç½®æ–¹å¼ï¼Œè¿™é‡Œä¸»è¦ä»‹ç»åœ¨windowä¸‹åˆ©ç”¨è™šæ‹Ÿæœºè¿›è¡Œé…ç½®ã€‚æ¨èé‡‡ç”¨ubuntu20.04ç³»ç»Ÿï¼Œå› ä¸ºæ²¡ä»€ä¹ˆå‘ğŸ˜‚ã€‚æ¨èä½¿ç”¨Virtual Boxå®‰è£…ubuntu20.04ã€‚
ä½¿ç”¨å®˜æ–¹ç»™çš„å‘½ä»¤å³å¯åˆæ­¥é…ç½®ç¯å¢ƒ
sudo apt-get install git build-essential gdb-multiarch qemu-system-misc gcc-riscv64-linux-gnu binutils-riscv64-linux-gnu sudo apt-get remove qemu-system-misc sudo apt-get install qemu-system-misc=1:4.2-3ubuntu6 æ¥ç€å®‰è£…å®˜æ–¹æŒ‡å¼•ç¡®è®¤ä»¥ä¸‹ä¸¤ä¸ªè½¯ä»¶å·²ç»å®‰è£…
~ &amp;gt; riscv64-unknown-elf-gcc --version riscv64-unknown-elf-gcc () 9.3.0 ... # å¯ä»¥çœ‹åˆ°è¾“å‡ºçš„ç‰ˆæœ¬å¹¶æ²¡æœ‰å®˜æ–¹æŒ‡å¯¼ä¹¦ä¸Šä¸€è‡´ï¼Œæ²¡æœ‰å…³ç³» # å¦‚æœå‡ºç°äº† Command &amp;#39;riscv64-unknown-elf-gcc&amp;#39; not found å­—æ ·ï¼Œè¯´æ˜æ²¡æœ‰å®‰è£…è¯¥å·¥å…·ï¼Œè¿è¡Œä¸‹é¢å‘½ä»¤å³å¯ # sudo apt install gcc-riscv64-unknown-elf ~ &amp;gt; qemu-system-riscv64 --version QEMU emulator version 4.2.1 (Debian 1:4.</description>
    </item>
    
    <item>
      <title>Lab1 Utilities</title>
      <link>https://flash-boy.github.io/posts/6.s081/labs/lab1/</link>
      <pubDate>Sun, 05 Jun 2022 00:00:00 +0000</pubDate>
      
      <guid>https://flash-boy.github.io/posts/6.s081/labs/lab1/</guid>
      <description>Utilitieså®éªŒç›®æ ‡æœ¬å®éªŒä¸»è¦æ˜¯æ¥ç†Ÿæ‚‰xv6å’Œå®ƒçš„ç³»ç»Ÿè°ƒç”¨ï¼Œç³»ç»Ÿè°ƒç”¨æ˜¯ä¸€ç±»ç‰¹æ®Šçš„å‡½æ•°ï¼Œæ˜¯æ“ä½œç³»ç»Ÿæä¾›çš„ä¸€ç±»å¯¹ç‰¹æ®Šèµ„æºçš„è®¿é—®ï¼Œåƒç£ç›˜ï¼ŒIOç­‰ã€‚æœ¬è¯¾ç¨‹æœ‰ä¸€ä¸ªæ ¸å¿ƒå°±æ˜¯ç†è§£ç³»ç»Ÿè°ƒç”¨æ˜¯å¦‚ä½•å®ç°çš„ï¼Œåœ¨åç»­è¯¾ç¨‹å†…å®¹ä¼šåˆè¯¦ç»†ä»‹ç»ã€‚åœ¨å‘½ä»¤è¡Œä¸­æˆ‘ä»¬ç»å¸¸çœ‹åˆ°è®¸å¤šå†…ç½®çš„å‘½ä»¤ä¾‹å¦‚ cd, lsç­‰ï¼Œè¿™äº›å‘½ä»¤å°±æ˜¯åˆ©ç”¨ç³»ç»Ÿè°ƒç”¨å°è£…çš„ç”¨æˆ·çº§ç¨‹åºã€‚labä¼šè¦æ±‚å®ç°å‡ ä¸ªç±»ä¼¼çš„å·¥å…·å‘½ä»¤ã€‚æ€»ä½“æ¥è¯´æœ¬labä¸éš¾ï¼Œä¸»è¦æ˜¯å¯¹xv6çš„ç†Ÿæ‚‰ã€‚
æ¯ä¸ªå®éªŒéƒ½æœ‰ç›¸åº”çš„ä»£ç åˆ†æ”¯ç®¡ç†ï¼Œæ‰€æœ‰åœ¨æ¯ä¸ªå®éªŒéœ€è¦åˆ‡æ¢åˆ°å¯¹åº”åˆ†æ”¯ã€‚åŸºæœ¬æŒ‰ç…§labä¸»é¡µçš„æç¤º(hint)å°±å¯ä»¥å®Œæˆè¯¥å®éªŒï¼Œ
å®éªŒè¯¦è§£Boot xv6 (easy)å¯åŠ¨xv6,è¿è¡Œå†…ç½®çš„lså‘½ä»¤ã€‚
å¾ˆç®€å•ï¼Œåªè¦ç…§ç€åšå°±èƒ½çœ‹åˆ°å¦‚ä¸‹æ•ˆæœã€‚
xv6æ“ä½œç³»ç»Ÿè‡ªå·±å®éªŒäº†ä¸€äº›å¸¸ç”¨çš„å‘½ä»¤ï¼Œåƒcat, ls, echoç­‰ã€‚æ¥ä¸‹æ¥çš„ä»»åŠ¡å°±æ˜¯å®ç°ä¸€äº›ç±»ä¼¼çš„å‘½ä»¤ã€‚
1. sleep (easy)sleep è¦æ±‚åœ¨ç¨‹åºsleepä¸€å°æ®µæ—¶é—´ï¼Œè§£å†³æ–¹æ³•æ˜¯è°ƒç”¨xv6ç³»ç»Ÿæä¾›çš„ç³»ç»Ÿè°ƒç”¨å‡½æ•°ã€‚è¿™é‡Œè¯´ä¸€ä¸‹xv6æºä»£ç ä¸»è¦æœ‰ä¸¤ä¸ªæ–‡ä»¶å¤¹ kernel/ å’Œ user/ã€‚kernelä¸»è¦æ˜¯å†…æ ¸ä»£ç çš„å®ç°ï¼Œuseråˆ™æ˜¯ç”¨æˆ·ç¼–å†™çš„ä»£ç ï¼Œä¾‹å¦‚å‰é¢çš„cat, ls, echoä»¥åŠæˆ‘ä»¬å®ç°çš„sleepç­‰ã€‚å› æ­¤æŒ‰ç…§è¦æ±‚ç¼–å†™ä»£ç  user/sleep.cä»£ç å¦‚ä¸‹
// user/sleep.c #include &amp;#34;kernel/types.h&amp;#34; #include &amp;#34;kernel/stat.h&amp;#34; #include &amp;#34;user/user.h&amp;#34; int main(int argc, char* argv[]){ if(argc != 2){ printf(&amp;#34;Usage: sleep &amp;lt;seconds&amp;gt;\n&amp;#34;); exit(1); } sleep(atoi(argv[1]) * 10); exit(0); } user/user.hå¤´æ–‡ä»¶åŒ…å«äº†xv6æä¾›çš„ç³»ç»Ÿè°ƒç”¨çš„å£°æ˜ï¼Œéœ€è¦åŒ…å«ã€‚
ç¨‹åºçš„è¿”å›xv6ä¸­å¿…é¡»ç”¨exitå‡½æ•°ã€‚
åˆ«å¿˜äº†æ›´æ–°Makefile
ç¼–è¯‘è¿è¡Œï¼Œå¹¶è¾“å…¥sleepå¯ä»¥çœ‹åˆ°å¦‚ä¸‹çš„
pingpong (easy)pipeæ˜¯è¿›ç¨‹é€šä¿¡çš„ä¸€ç§æ–¹å¼ï¼Œpipeæ˜¯ä¸€ç§å•å‘çš„æ•°æ®ä¼ è¾“ï¼Œä»ä¸€ç«¯è¾“å…¥ï¼Œä»å¦ä¸€ç«¯è¾“å‡ºã€‚pingpongè¦æ±‚åœ¨çˆ¶å­è¿›ç¨‹ä¸­ä¼ è¾“æ•°æ®ï¼Œå¹¶è¾“å‡ºå„è‡ªpidã€‚æ ¸å¿ƒå°±æ˜¯åˆ©ç”¨pipeå‡½æ•°ä¸¤æ¬¡ï¼Œåˆ©ç”¨forkå‡½æ•°åˆ›å»ºå­è¿›ç¨‹ï¼Œåœ¨çˆ¶å­è¿›ç¨‹ä¸­æ³¨æ„å…³é—­ä¸éœ€è¦çš„è¯»ç«¯å’Œå†™ç«¯ï¼Œç„¶åè¯»å†™pipeã€‚
// user/pingpong.c #include &amp;#34;kernel/types.h&amp;#34; #include &amp;#34;kernel/stat.h&amp;#34; #include &amp;#34;user/user.h&amp;#34; int main(int argc, char* argv[]){ int p1[2], p2[2]; if(pipe(p1) &amp;lt; 0 || pipe(p2) &amp;lt; 0){ printf(&amp;#34;Error: pipe()\n&amp;#34;); exit(1); } int pid; if((pid = fork()) == 0){ close(p1[1]); close(p2[0]); char c; int p = getpid(); read(p1[0], &amp;amp;c, 1); printf(&amp;#34;%d: received ping\n&amp;#34;, p); close(p1[0]); write(p2[1], &amp;amp;c, 1); close(p2[1]); }else{ close(p1[0]); close(p2[1]); int p = getpid(); char c; write(p1[1], &amp;#34;w&amp;#34;, 1); close(p1[1]); read(p2[0], &amp;amp;c, 1); printf(&amp;#34;%d: received pong\n&amp;#34;, p); close(p2[0]); } exit(0); } æ•ˆæœå¦‚å›¾</description>
    </item>
    
    <item>
      <title>Lab2 System calls</title>
      <link>https://flash-boy.github.io/posts/6.s081/labs/lab2/</link>
      <pubDate>Sun, 05 Jun 2022 00:00:00 +0000</pubDate>
      
      <guid>https://flash-boy.github.io/posts/6.s081/labs/lab2/</guid>
      <description>System callså®éªŒç›®æ ‡æœ¬å®éªŒä¸»è¦æ˜¯å»äº†è§£ç³»ç»Ÿè°ƒç”¨æ˜¯å¦‚ä½•å®ç°çš„ï¼Œxv6æä¾›äº†20å¤šä¸ªç³»ç»Ÿè°ƒç”¨ï¼Œç³»ç»Ÿè°ƒç”¨é‡‡ç”¨çš„æ˜¯ä¸€ç§trapæœºåˆ¶ï¼Œå¹¶ä¸æ˜¯å‘ä¼ ç»Ÿçš„ç”¨æˆ·æ€å‡½æ•°è°ƒç”¨ï¼Œè¿™é‡Œéœ€è¦é€šè¿‡trapæœºåˆ¶ï¼Œè¿›å…¥å†…æ ¸ï¼Œæ‰§è¡Œå®Œå®é™…çš„ç³»ç»Ÿè°ƒç”¨ï¼Œç„¶ååˆ‡æ¢å›ç”¨æˆ·æ€ç¨‹åºã€‚è¦å®Œæˆæœ¬labï¼Œéœ€è¦ä»”ç»†é˜…è¯»ä»¥ä¸‹å‡ ä¸ªæ–‡ä»¶çš„æºä»£ç ã€‚
user/user.h ç”¨æˆ·ç³»ç»Ÿè°ƒç”¨çš„å‡½æ•°åŸå‹ï¼Œä»¥åŠä¸€äº›ç”¨æˆ·å‡½æ•°åŸå‹ã€‚ user/usys.pl ç”¨æˆ·ç³»ç»Ÿè°ƒç”¨å‡½æ•°åŸå‹å®ç°çš„æ±‡ç¼–è„šæœ¬ã€‚ kernel/syscall.h ç³»ç»Ÿè°ƒç”¨ç¼–å· kernel/syscall.c å†…æ ¸ç³»ç»Ÿè°ƒç”¨æ¥å£å®ç° kernel/sysproc.c å†…æ ¸å®é™…ç³»ç»Ÿè°ƒç”¨å‡½æ•°å®ç° æ€»ç»“ä¸€ä¸‹ï¼Œç³»ç»Ÿè°ƒç”¨å®é™…è¿‡ç¨‹å’Œæ­¥éª¤
ç”¨æˆ·è°ƒç”¨user/user.hä¸­å£°æ˜çš„ç³»ç»Ÿè°ƒç”¨å‡½æ•° user/usys.plä¸­çš„æ±‡ç¼–ä»£ç è¡¨ç¤ºä¸€ä¸ªç³»ç»Ÿè°ƒç”¨åªæ˜¯å°†ç³»ç»Ÿè°ƒç”¨ç¼–å·æ”¾è¿›a7å¯„å­˜å™¨ä¹‹ï¼Œç„¶åè°ƒç”¨ecallæŒ‡ä»¤è¿›å…¥å†…æ ¸çš„trapä¸­ å†…æ ¸åœ¨trapä¸­å¤„ç†ï¼Œè¿è¡Œkernel/syscall.cä¸­çš„syscallå‡½æ•° syscallå‡½æ•°é€šè¿‡a7å¯„å­˜å™¨çš„ç³»ç»Ÿè°ƒç”¨ç¼–å·æ‰¾åˆ°å¯¹åº”çš„å‡½æ•°(å®ç°åœ¨kernel/sysproc.cä¸­) è¿è¡Œkernel/sysproc.cä¸­å¯¹åº”çš„ç³»ç»Ÿè°ƒç”¨å‡½æ•° å®éªŒè¯¦è§£System call tracing (moderate)å®éªŒè¦æ±‚å®ç°traceå‡½æ•°ï¼Œé€šè¿‡traceå‡½æ•°ä¼ å…¥ä¸€ä¸ªmask,å¯ä»¥è¿½è¸ªç¨‹åºåœ¨è¿è¡Œè¿‡ç¨‹ä¸­è°ƒç”¨è¿‡å“ªäº›å¯¹åº”ç³»ç»Ÿè°ƒç”¨ï¼Œã€‚æ ¹æ®hintçš„æç¤º ä¸€ä¸ªå¾ˆè‡ªç„¶çš„æƒ³æ³•æ˜¯åœ¨è¿è¡Œkernel/syscall.cä¸­çš„syacallä¸­å¤„ç†ï¼Œå½“æˆ‘ä»¬è°ƒç”¨ç³»ç»Ÿå‡½æ•°æ—¶ï¼Œä¼šèµ°åˆ°è¯¥å‡½æ•°ï¼Œ é€šè¿‡åˆ¤æ–­ç³»ç»Ÿè°ƒç”¨æ˜¯å¦ä¸ºæˆ‘ä»¬éœ€è¦è¿½è¸ªçš„ç³»ç»Ÿè°ƒç”¨ï¼Œå¦‚æœæ˜¯ï¼Œè¾“å‡ºç›¸å…³æ¶ˆæ¯ï¼Œå¦‚ä½•ä¿å­˜æˆ‘ä»¬éœ€è¦è¿½è¸ªçš„ç³»ç»Ÿè°ƒç”¨maskï¼Œæ ¹æ®æç¤ºåœ¨struct procä¸­è¿›è¡Œä¿å­˜ã€‚è§£å†³æ–¹æ³•å¦‚ä¸‹ã€‚
åœ¨user/user.hä¸­å£°æ˜traceç³»ç»Ÿè°ƒç”¨å’ŒåŸå‹ï¼Œä»¥åŠåœ¨user/usys.plè„šæœ¬ä¸­æ·»åŠ å¯¹åº”çš„å®ç°
// user/user.h int trace(int); // user/usys.pl entry(&amp;#34;trace&amp;#34;); æ·»åŠ ç³»ç»Ÿè°ƒç”¨ç¼–å·åˆ°kernel/syscall.hä¸­
// kernel/syscall.h #define SYS_trace 22 ä¿®æ”¹kernel/syscall.cä¸­çš„å‡½æ•°æŒ‡é’ˆæ•°ç»„ï¼Œä»¥åŠå®šä¹‰å‡½æ•°åå­—ç¬¦ä¸²æ•°ç»„ï¼Œä»¥åŠåœ¨
// kernel/syscall.c extern uint64 sys_trace(void); static uint64 (*syscalls[])(void) = { // ... [SYS_trace] sys_trace, }; static char* syscallsStr[] = { // ... [SYS_trace] &amp;#34;syscall trace&amp;#34;, }; void syscall(void) { int num; struct proc *p = myproc(); num = p-&amp;gt;trapframe-&amp;gt;a7; if(num &amp;gt; 0 &amp;amp;&amp;amp; num &amp;lt; NELEM(syscalls) &amp;amp;&amp;amp; syscalls[num]) { p-&amp;gt;trapframe-&amp;gt;a0 = syscalls[num](); // å¦‚æœç³»ç»Ÿè°ƒç”¨ç¼–å·åœ¨æ©ç ä¸­æ‰“å°è¿½è¸ªä¿¡æ¯ // a0å¯„å­˜å™¨ä¿å­˜ç€ç³»ç»Ÿè°ƒç”¨è¿”å›å€¼ if(p-&amp;gt;trace_mask &amp;amp; (1 &amp;lt;&amp;lt; num)){ printf(&amp;#34;%d: %s -&amp;gt; %d\n&amp;#34;, p-&amp;gt;pid, syscallsStr[num], p-&amp;gt;trapframe-&amp;gt;a0); } } else { printf(&amp;#34;%d %s: unknown sys call %d\n&amp;#34;, p-&amp;gt;pid, p-&amp;gt;name, num); p-&amp;gt;trapframe-&amp;gt;a0 = -1; } } åœ¨kernel/proc.</description>
    </item>
    
    <item>
      <title>Lab3 Page tables</title>
      <link>https://flash-boy.github.io/posts/6.s081/labs/lab3/</link>
      <pubDate>Sun, 05 Jun 2022 00:00:00 +0000</pubDate>
      
      <guid>https://flash-boy.github.io/posts/6.s081/labs/lab3/</guid>
      <description>Page tableså®éªŒç›®æ ‡æœ¬å®éªŒä¸»è¦äº†è§£xv6è™šæ‹Ÿå†…å­˜çš„åº•å±‚å®ç°ï¼Œxv6èƒ½å¤Ÿè¿è¡Œçš„æœºåˆ¶æ˜¯å†…æ ¸é‡‡ç”¨äº†æ’ç­‰æ˜ å°„ï¼Œå³æŠŠå†…æ ¸çš„è™šæ‹Ÿåœ°å€å’Œç‰©ç†åœ°å€åœ¨å†…æ ¸é¡µè¡¨å»ºç«‹çš„æ˜¯æ’ç­‰æ˜ å°„ï¼ŒåŒæ—¶xv6é‡‡ç”¨çš„æ˜¯ä¸‰çº§é¡µè¡¨ã€‚è¿™ä¸ªå®éªŒä¸»è¦æ˜¯å¼„æ‡‚xv6çš„å†…æ ¸å¸ƒå±€ä»¥åŠé¡µè¡¨æœºåˆ¶ï¼Œä¸»è¦çš„æºä»£ç æ˜¯kernel/kalloc.c, kernel/vm.c, kernel/memlayout.hã€‚
å®éªŒè¯¦è§£Print a page table (easy)ä¸»è¦æ˜¯å®ç°ä¸€ä¸ªpagetableçš„å±‚çº§æ‰“å°ï¼Œè¿™ä¸ªæ¯”è¾ƒç®€å•ï¼Œåªè¦å¼„å¾—xv6çš„pagetableä¸‰çº§é¡µè¡¨ç»“æ„ï¼Œé…åˆkernel/riscv.hé‡Œæä¾›çš„é¡µè¡¨å®å¾ˆå®¹æ˜“å¾—åˆ°ç­”æ¡ˆ
// kernel/vm.c // helper funtion for vmprint() static void vmprinthelper(pagetable_t pagetable, int level){ static char* prefix[] = {&amp;#34;..&amp;#34;, &amp;#34;.. ..&amp;#34;, &amp;#34;.. .. ..&amp;#34;}; if(level &amp;gt; 2) return; for(int i = 0; i &amp;lt; 512; i++){ pte_t pte = pagetable[i]; if(pte &amp;amp; PTE_V){ // this PTE points to a lower-level page table. uint64 child = PTE2PA(pte); printf(&amp;#34;%s%d: pte %p pa %p\n&amp;#34;, prefix[level], i, pte, child); vmprinthelper((pagetable_t)child, level + 1); } } } // printf the valid pte of pagetable // pagetable: the physical pagetable address need to print void vmprint(pagetable_t pagetable){ printf(&amp;#34;page table %p\n&amp;#34;, pagetable); vmprinthelper(pagetable, 0); } æ•ˆæœå¦‚å›¾ A kernel page table per process (hard)åŸå…ˆç‰ˆæœ¬çš„xv6æœ‰ä¸€ä¸ªå…¨å±€çš„å†…æ ¸é¡µè¡¨ï¼Œé‡‡ç”¨æ’ç­‰æ˜ å°„ï¼ŒåŒæ—¶æ¯ä¸ªè¿›ç¨‹åœ¨ç”¨æˆ·ç©ºé—´æœ‰ä¸€ä¸ªé¡µè¡¨ã€‚å› æ­¤ï¼Œåœ¨è¿›ç¨‹ç”±ç”¨æˆ·æ€å’Œå†…æ ¸æ€åˆ‡æ¢çš„è¿‡ç¨‹ä¸­ï¼Œéœ€è¦åˆ‡æ¢é¡µè¡¨ï¼Œè¿™ä¼šå¯¼è‡´cpuçš„L1Cacheå¤±æ•ˆï¼Œé™ä½æ•ˆç‡ã€‚åŒæ—¶ä¹Ÿä¼šé€ æˆå¦‚æœæƒ³è¦å°†ç”¨æˆ·æ€çš„æ•°æ®å¤åˆ¶åˆ°å†…æ ¸æ€ï¼Œé¦–å…ˆéœ€è¦ä¸»åŠ¨éå†ç”¨æˆ·é¡µè¡¨å¾—åˆ°æ•°æ®çš„ç‰©ç†åœ°å€ï¼Œç„¶åå› ä¸ºåœ¨å†…æ ¸ç‰©ç†åœ°å€å’Œè™šæ‹Ÿåœ°å€æ˜¯æ’ç­‰æ˜ å°„ï¼Œåœ¨åˆ©ç”¨æ•°æ®çš„ç‰©ç†åœ°å€è¿›è¡Œå¤åˆ¶ã€‚å¦‚æœå°†å†…æ ¸é¡µè¡¨å’Œç”¨æˆ·é¡µè¡¨ åˆä¸ºä¸€ä¸ªé¡µè¡¨ï¼Œä½†ä¸åŒé¡µè¡¨é¡¹å…·æœ‰ä¸åŒçš„æƒé™ï¼Œè¿™æ ·ä¸ä»…èƒ½è§£å†³L1Cacheå¤±æ•ˆçš„é—®é¢˜ï¼ŒåŒæ—¶ä¹Ÿèƒ½å°†ç”¨æˆ·æ€æ•°æ®å¤åˆ¶åˆ°å†…æ ¸æ€ä¸éœ€è¦é€šè¿‡ä¸€å±‚è½¬æ¢é—´æ¥å¤åˆ¶æ¥å®Œæˆæ•°æ®çš„å¤åˆ¶ã€‚</description>
    </item>
    
    <item>
      <title>Lab4 Traps</title>
      <link>https://flash-boy.github.io/posts/6.s081/labs/lab4/</link>
      <pubDate>Sun, 05 Jun 2022 00:00:00 +0000</pubDate>
      
      <guid>https://flash-boy.github.io/posts/6.s081/labs/lab4/</guid>
      <description>Trapså®éªŒç›®æ ‡ç³»ç»Ÿè°ƒç”¨ï¼Œå¼‚å¸¸å’Œä¸­æ–­æ˜¯åº”ç”¨ç¨‹åºéœ€è¦å“åº”ç¨‹åºæˆ–è€…å¤–éƒ¨è®¾å¤‡å¿…é¡»åšå‡ºçš„åŠ¨ä½œï¼Œæ“ä½œç³»ç»Ÿé‡‡ç”¨äº†trapçš„æ–¹å¼å¤„ç†ä¸Šè¿°ä¸‰ç§æƒ…å†µã€‚trapçš„æ–¹å¼æä¾›äº†ä¸€ç§å®‰å…¨ï¼Œå¯é çš„æ–¹å¼å¯¹å¤–éƒ¨è¾“å…¥æˆ–è€…ç¨‹åºç³»ç»Ÿè°ƒç”¨è¿›è¡Œå“åº”å¤„ç†ã€‚trapçš„æ ¸å¿ƒå°±æ˜¯åˆ©ç”¨ä¸€æ®µç§°ä¸ºtrampolineçš„ä»£ç ä½œä¸º&amp;quot;è·³æ¿&amp;quot;å’Œåˆ©ç”¨trapframeä¿å­˜åº”ç”¨ç¨‹åºè¿è¡ŒçŠ¶æ€ã€‚
å®éªŒè¯¦è§£Backtrace (moderate)ç¨‹åºçš„æ ˆå¸§æ ‡ç¤ºç€ç¨‹åºçš„å‡½æ•°è°ƒç”¨æ ˆï¼Œå®ç°ä¸€ä¸ªå‡½æ•°æ¥æ‰“å°å½“å‰å‡½æ•°çš„è°ƒç”¨æ ˆå¸§ï¼Œæ ¸å¿ƒå°±æ˜¯åˆ©ç”¨r_fpå‡½æ•°è¯»å–å‡½æ•°çš„å¸§æŒ‡é’ˆï¼Œä¸€ä¸ªå…¸å‹çš„æ ˆå¸§æ˜¯å…ˆå‹å…¥å‡½æ•°è¿”å›åœ°å€ï¼Œç„¶åå‹å…¥(prev)æ ˆå¸§ã€‚å¦‚å›¾æ‰€ç¤ºä¸ºä¸€ä¸ªå…¸å‹çš„æ ˆå¸§ã€‚
å› æ­¤å½“å‰çš„fp-8ä¿å­˜ç€å‡½æ•°è¿”å›åœ°å€ï¼Œfp-16ä¿å­˜ç€ä¸Šä¸€ä¸ªæ ˆå¸§fpåœ°å€ã€‚å› æ­¤backtraceå‡½æ•°å¦‚ä¸‹æ‰€ç¤º
// kernel/printf.c // backtrace for debug void backtrace(){ printf(&amp;#34;backtrace:\n&amp;#34;); uint64 fp = r_fp(); // xv6é»˜è®¤ç”¨æˆ·æ ˆæœ€å¤§ä¸º4096KB while(PGROUNDUP(fp) - PGROUNDDOWN(fp) == PGSIZE){ uint64 ra = *(uint64*)((char*)fp - 8); printf(&amp;#34;%p\n&amp;#34;, ra); fp = *(uint64*)((char*)fp - 16); } } è¿è¡Œæ•ˆæœå¦‚å›¾ Alarm (hard)alarmæ˜¯è¦ä½ æä¾›ä¸€ä¸ªç³»ç»Ÿè°ƒç”¨å®ç°ï¼Œæ¯å½“è¿›ç¨‹è°ƒç”¨è¯¥ç³»ç»Ÿè°ƒç”¨æ—¶ï¼Œæä¾›ä¸¤ä¸ªå‚æ•°nå’Œfn, æ¯ç»è¿‡nä¸ªç³»ç»Ÿcpuæ—¶é—´ç‰‡ï¼Œæ‰§è¡Œä¸€æ¬¡å›è°ƒå‡½æ•°fnã€‚
æ ¸å¿ƒæ€è·¯æ˜¯ç†è§£trapæœºåˆ¶ï¼Œå½“æœ‰ä¸€ä¸ªç³»ç»Ÿè°ƒç”¨é€šè¿‡ecallè¿›å…¥trampolineä»£ç çš„uservecéƒ¨åˆ†ï¼Œè¯¥æ®µä»£ç ä¿å­˜å¯„å­˜å™¨çŠ¶æ€åˆ°p-&amp;gt;trapframe,ç„¶åè¿›å…¥kernel/trap.cä¸­çš„usertrapå‡½æ•°å¤„ç†ï¼Œè¯¥å‡½æ•°æ ¹æ®è¿›å…¥trapçš„ä¸åŒåŸå› è°ƒç”¨ä¸åŒçš„å‡½æ•°å¤„ç†ã€‚æ‰§è¡Œå®Œæ¯•åï¼Œè°ƒç”¨kernel/trap.cä¸­çš„usertrapretå‡½æ•°ï¼Œè¯¥å‡½æ•°ä¼šè®¾ç½®é¡µè¡¨å’Œä¸€äº›p-&amp;gt;trapframeçš„é»˜è®¤é¡¹ä»¥ä¾›ä¸‹æ¬¡trapä½¿ç”¨ï¼Œä»¥åŠè°ƒç”¨trampoline.Sä¸­çš„userretå‡½æ•°ï¼Œè¯¥å‡½æ•°ç”¨p-&amp;gt;trapframeçš„å€¼é‡æ–°æ¢å¤å¯„å­˜å™¨çŠ¶æ€ã€‚
å› æ­¤ï¼Œä¸€ä¸ªæ ¸å¿ƒçš„æ€è·¯æ˜¯å°†alarmç³»ç»Ÿè°ƒç”¨çš„å‚æ•°ä¿å­˜åœ¨struct procä¸­ï¼Œåœ¨æ¯æ¬¡trapè¿‡ç¨‹ä¸­ï¼Œå¦‚æœæ˜¯å®šæ—¶å™¨ä¸­æ–­è¿›å…¥trapåˆ™éœ€è¦å°†å¯¹åº”çš„ticksåŠ 1ï¼Œä¸€æ—¦è¾¾åˆ°è¦æ±‚ï¼Œéœ€è¦åœ¨trapå¤„ç†å‡½æ•°ä¸­å°†è¿”å›å€¼å³p-&amp;gt;trapframe-&amp;gt;epcå€¼è®¾ç½®ä¸ºè¯¥fnå‡½æ•°ã€‚ç„¶åç³»ç»Ÿä¼šè°ƒç”¨è¯¥fnå‡½æ•°ï¼Œä½†å¦‚ä½•è¿”å›åˆ°ä¸€å¼€å§‹çš„å‡½æ•°è°ƒç”¨å¤„å‘¢ï¼Ÿç­”æ¡ˆæ˜¯åˆ©ç”¨sigreturnå‡½æ•°ï¼Œåœ¨trapå¤„ç†å‡½æ•°ä¸­ä¿å­˜å½“å‰çš„trapframeåˆ°ä¸€ä¸ªæ–°çš„trapframeä¸­ï¼Œåœ¨sigreturnç³»ç»Ÿè°ƒç”¨ä¸­ï¼Œå°†trapframeä¿å­˜ä¸ºåŸå…ˆçš„å€¼ï¼Œå› æ­¤ï¼Œsigalarmå’Œsigreturnéœ€è¦é…å¯¹ä½¿ç”¨ã€‚
// kernel/sysproc.c uint64 sys_sigalarm(void){ int alarm_interval; uint64 fn; if(argint(0, &amp;amp;alarm_interval) &amp;lt; 0) return -1; if(argaddr(1, &amp;amp;fn) &amp;lt; 0) return -1; struct proc* p = myproc(); if(alarm_interval &amp;lt; 0) alarm_interval = 0; // ä¿å­˜å‚æ•° p-&amp;gt;alarm_interval = alarm_interval; p-&amp;gt;handler = fn; p-&amp;gt;ticks = 0; return 0; } uint64 sys_sigreturn(void){ struct proc* p = myproc(); *p-&amp;gt;trapframe = *p-&amp;gt;savedtrapframe; p-&amp;gt;ticks = 0; return 0; } // kernel/trap.</description>
    </item>
    
  </channel>
</rss>
