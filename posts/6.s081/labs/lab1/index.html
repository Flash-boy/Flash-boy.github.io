<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="color-scheme" content="light dark">


<meta http-equiv="Content-Security-Policy" content="upgrade-insecure-requests; block-all-mixed-content; default-src 'self'; child-src 'self'; font-src 'self' https://fonts.gstatic.com https://cdn.jsdelivr.net/; form-action 'self'; frame-src 'self'; img-src 'self'; object-src 'none'; style-src 'self' 'unsafe-inline' https://fonts.googleapis.com/ https://cdn.jsdelivr.net/; script-src 'self' 'unsafe-inline' https://www.google-analytics.com https://cdn.jsdelivr.net/; prefetch-src 'self'; connect-src 'self' https://www.google-analytics.com;">




<meta name="author" content="Yang Wei">
<meta name="description" content="Utilitieså®éªŒç›®æ ‡æœ¬å®éªŒä¸»è¦æ˜¯æ¥ç†Ÿæ‚‰xv6å’Œå®ƒçš„ç³»ç»Ÿè°ƒç”¨ï¼Œç³»ç»Ÿè°ƒç”¨æ˜¯ä¸€ç±»ç‰¹æ®Šçš„å‡½æ•°ï¼Œæ˜¯æ“ä½œç³»ç»Ÿæä¾›çš„ä¸€ç±»å¯¹ç‰¹æ®Šèµ„æºçš„è®¿é—®ï¼Œåƒç£ç›˜ï¼ŒIOç­‰ã€‚æœ¬è¯¾ç¨‹æœ‰ä¸€ä¸ªæ ¸å¿ƒå°±æ˜¯ç†è§£ç³»ç»Ÿè°ƒç”¨æ˜¯å¦‚ä½•å®ç°çš„ï¼Œåœ¨åç»­è¯¾ç¨‹å†…å®¹ä¼šåˆè¯¦ç»†ä»‹ç»ã€‚åœ¨å‘½ä»¤è¡Œä¸­æˆ‘ä»¬ç»å¸¸çœ‹åˆ°è®¸å¤šå†…ç½®çš„å‘½ä»¤ä¾‹å¦‚ cd, lsç­‰ï¼Œè¿™äº›å‘½ä»¤å°±æ˜¯åˆ©ç”¨ç³»ç»Ÿè°ƒç”¨å°è£…çš„ç”¨æˆ·çº§ç¨‹åºã€‚labä¼šè¦æ±‚å®ç°å‡ ä¸ªç±»ä¼¼çš„å·¥å…·å‘½ä»¤ã€‚æ€»ä½“æ¥è¯´æœ¬labä¸éš¾ï¼Œä¸»è¦æ˜¯å¯¹xv6çš„ç†Ÿæ‚‰ã€‚
æ¯ä¸ªå®éªŒéƒ½æœ‰ç›¸åº”çš„ä»£ç åˆ†æ”¯ç®¡ç†ï¼Œæ‰€æœ‰åœ¨æ¯ä¸ªå®éªŒéœ€è¦åˆ‡æ¢åˆ°å¯¹åº”åˆ†æ”¯ã€‚åŸºæœ¬æŒ‰ç…§labä¸»é¡µçš„æç¤º(hint)å°±å¯ä»¥å®Œæˆè¯¥å®éªŒï¼Œ
å®éªŒè¯¦è§£Boot xv6 (easy)å¯åŠ¨xv6,è¿è¡Œå†…ç½®çš„lså‘½ä»¤ã€‚
å¾ˆç®€å•ï¼Œåªè¦ç…§ç€åšå°±èƒ½çœ‹åˆ°å¦‚ä¸‹æ•ˆæœã€‚
xv6æ“ä½œç³»ç»Ÿè‡ªå·±å®éªŒäº†ä¸€äº›å¸¸ç”¨çš„å‘½ä»¤ï¼Œåƒcat, ls, echoç­‰ã€‚æ¥ä¸‹æ¥çš„ä»»åŠ¡å°±æ˜¯å®ç°ä¸€äº›ç±»ä¼¼çš„å‘½ä»¤ã€‚
1. sleep (easy)sleep è¦æ±‚åœ¨ç¨‹åºsleepä¸€å°æ®µæ—¶é—´ï¼Œè§£å†³æ–¹æ³•æ˜¯è°ƒç”¨xv6ç³»ç»Ÿæä¾›çš„ç³»ç»Ÿè°ƒç”¨å‡½æ•°ã€‚è¿™é‡Œè¯´ä¸€ä¸‹xv6æºä»£ç ä¸»è¦æœ‰ä¸¤ä¸ªæ–‡ä»¶å¤¹ kernel/ å’Œ user/ã€‚kernelä¸»è¦æ˜¯å†…æ ¸ä»£ç çš„å®ç°ï¼Œuseråˆ™æ˜¯ç”¨æˆ·ç¼–å†™çš„ä»£ç ï¼Œä¾‹å¦‚å‰é¢çš„cat, ls, echoä»¥åŠæˆ‘ä»¬å®ç°çš„sleepç­‰ã€‚å› æ­¤æŒ‰ç…§è¦æ±‚ç¼–å†™ä»£ç  user/sleep.cä»£ç å¦‚ä¸‹
// user/sleep.c #include &#34;kernel/types.h&#34; #include &#34;kernel/stat.h&#34; #include &#34;user/user.h&#34; int main(int argc, char* argv[]){ if(argc != 2){ printf(&#34;Usage: sleep &lt;seconds&gt;\n&#34;); exit(1); } sleep(atoi(argv[1]) * 10); exit(0); } user/user.hå¤´æ–‡ä»¶åŒ…å«äº†xv6æä¾›çš„ç³»ç»Ÿè°ƒç”¨çš„å£°æ˜ï¼Œéœ€è¦åŒ…å«ã€‚
ç¨‹åºçš„è¿”å›xv6ä¸­å¿…é¡»ç”¨exitå‡½æ•°ã€‚
åˆ«å¿˜äº†æ›´æ–°Makefile
ç¼–è¯‘è¿è¡Œï¼Œå¹¶è¾“å…¥sleepå¯ä»¥çœ‹åˆ°å¦‚ä¸‹çš„
pingpong (easy)pipeæ˜¯è¿›ç¨‹é€šä¿¡çš„ä¸€ç§æ–¹å¼ï¼Œpipeæ˜¯ä¸€ç§å•å‘çš„æ•°æ®ä¼ è¾“ï¼Œä»ä¸€ç«¯è¾“å…¥ï¼Œä»å¦ä¸€ç«¯è¾“å‡ºã€‚pingpongè¦æ±‚åœ¨çˆ¶å­è¿›ç¨‹ä¸­ä¼ è¾“æ•°æ®ï¼Œå¹¶è¾“å‡ºå„è‡ªpidã€‚æ ¸å¿ƒå°±æ˜¯åˆ©ç”¨pipeå‡½æ•°ä¸¤æ¬¡ï¼Œåˆ©ç”¨forkå‡½æ•°åˆ›å»ºå­è¿›ç¨‹ï¼Œåœ¨çˆ¶å­è¿›ç¨‹ä¸­æ³¨æ„å…³é—­ä¸éœ€è¦çš„è¯»ç«¯å’Œå†™ç«¯ï¼Œç„¶åè¯»å†™pipeã€‚
// user/pingpong.c #include &#34;kernel/types.h&#34; #include &#34;kernel/stat.h&#34; #include &#34;user/user.h&#34; int main(int argc, char* argv[]){ int p1[2], p2[2]; if(pipe(p1) &lt; 0 || pipe(p2) &lt; 0){ printf(&#34;Error: pipe()\n&#34;); exit(1); } int pid; if((pid = fork()) == 0){ close(p1[1]); close(p2[0]); char c; int p = getpid(); read(p1[0], &amp;c, 1); printf(&#34;%d: received ping\n&#34;, p); close(p1[0]); write(p2[1], &amp;c, 1); close(p2[1]); }else{ close(p1[0]); close(p2[1]); int p = getpid(); char c; write(p1[1], &#34;w&#34;, 1); close(p1[1]); read(p2[0], &amp;c, 1); printf(&#34;%d: received pong\n&#34;, p); close(p2[0]); } exit(0); } æ•ˆæœå¦‚å›¾">
<meta name="keywords" content="blog,developer,personal">

<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Lab1 Utilities"/>
<meta name="twitter:description" content="Utilitieså®éªŒç›®æ ‡æœ¬å®éªŒä¸»è¦æ˜¯æ¥ç†Ÿæ‚‰xv6å’Œå®ƒçš„ç³»ç»Ÿè°ƒç”¨ï¼Œç³»ç»Ÿè°ƒç”¨æ˜¯ä¸€ç±»ç‰¹æ®Šçš„å‡½æ•°ï¼Œæ˜¯æ“ä½œç³»ç»Ÿæä¾›çš„ä¸€ç±»å¯¹ç‰¹æ®Šèµ„æºçš„è®¿é—®ï¼Œåƒç£ç›˜ï¼ŒIOç­‰ã€‚æœ¬è¯¾ç¨‹æœ‰ä¸€ä¸ªæ ¸å¿ƒå°±æ˜¯ç†è§£ç³»ç»Ÿè°ƒç”¨æ˜¯å¦‚ä½•å®ç°çš„ï¼Œåœ¨åç»­è¯¾ç¨‹å†…å®¹ä¼šåˆè¯¦ç»†ä»‹ç»ã€‚åœ¨å‘½ä»¤è¡Œä¸­æˆ‘ä»¬ç»å¸¸çœ‹åˆ°è®¸å¤šå†…ç½®çš„å‘½ä»¤ä¾‹å¦‚ cd, lsç­‰ï¼Œè¿™äº›å‘½ä»¤å°±æ˜¯åˆ©ç”¨ç³»ç»Ÿè°ƒç”¨å°è£…çš„ç”¨æˆ·çº§ç¨‹åºã€‚labä¼šè¦æ±‚å®ç°å‡ ä¸ªç±»ä¼¼çš„å·¥å…·å‘½ä»¤ã€‚æ€»ä½“æ¥è¯´æœ¬labä¸éš¾ï¼Œä¸»è¦æ˜¯å¯¹xv6çš„ç†Ÿæ‚‰ã€‚
æ¯ä¸ªå®éªŒéƒ½æœ‰ç›¸åº”çš„ä»£ç åˆ†æ”¯ç®¡ç†ï¼Œæ‰€æœ‰åœ¨æ¯ä¸ªå®éªŒéœ€è¦åˆ‡æ¢åˆ°å¯¹åº”åˆ†æ”¯ã€‚åŸºæœ¬æŒ‰ç…§labä¸»é¡µçš„æç¤º(hint)å°±å¯ä»¥å®Œæˆè¯¥å®éªŒï¼Œ
å®éªŒè¯¦è§£Boot xv6 (easy)å¯åŠ¨xv6,è¿è¡Œå†…ç½®çš„lså‘½ä»¤ã€‚
å¾ˆç®€å•ï¼Œåªè¦ç…§ç€åšå°±èƒ½çœ‹åˆ°å¦‚ä¸‹æ•ˆæœã€‚
xv6æ“ä½œç³»ç»Ÿè‡ªå·±å®éªŒäº†ä¸€äº›å¸¸ç”¨çš„å‘½ä»¤ï¼Œåƒcat, ls, echoç­‰ã€‚æ¥ä¸‹æ¥çš„ä»»åŠ¡å°±æ˜¯å®ç°ä¸€äº›ç±»ä¼¼çš„å‘½ä»¤ã€‚
1. sleep (easy)sleep è¦æ±‚åœ¨ç¨‹åºsleepä¸€å°æ®µæ—¶é—´ï¼Œè§£å†³æ–¹æ³•æ˜¯è°ƒç”¨xv6ç³»ç»Ÿæä¾›çš„ç³»ç»Ÿè°ƒç”¨å‡½æ•°ã€‚è¿™é‡Œè¯´ä¸€ä¸‹xv6æºä»£ç ä¸»è¦æœ‰ä¸¤ä¸ªæ–‡ä»¶å¤¹ kernel/ å’Œ user/ã€‚kernelä¸»è¦æ˜¯å†…æ ¸ä»£ç çš„å®ç°ï¼Œuseråˆ™æ˜¯ç”¨æˆ·ç¼–å†™çš„ä»£ç ï¼Œä¾‹å¦‚å‰é¢çš„cat, ls, echoä»¥åŠæˆ‘ä»¬å®ç°çš„sleepç­‰ã€‚å› æ­¤æŒ‰ç…§è¦æ±‚ç¼–å†™ä»£ç  user/sleep.cä»£ç å¦‚ä¸‹
// user/sleep.c #include &#34;kernel/types.h&#34; #include &#34;kernel/stat.h&#34; #include &#34;user/user.h&#34; int main(int argc, char* argv[]){ if(argc != 2){ printf(&#34;Usage: sleep &lt;seconds&gt;\n&#34;); exit(1); } sleep(atoi(argv[1]) * 10); exit(0); } user/user.hå¤´æ–‡ä»¶åŒ…å«äº†xv6æä¾›çš„ç³»ç»Ÿè°ƒç”¨çš„å£°æ˜ï¼Œéœ€è¦åŒ…å«ã€‚
ç¨‹åºçš„è¿”å›xv6ä¸­å¿…é¡»ç”¨exitå‡½æ•°ã€‚
åˆ«å¿˜äº†æ›´æ–°Makefile
ç¼–è¯‘è¿è¡Œï¼Œå¹¶è¾“å…¥sleepå¯ä»¥çœ‹åˆ°å¦‚ä¸‹çš„
pingpong (easy)pipeæ˜¯è¿›ç¨‹é€šä¿¡çš„ä¸€ç§æ–¹å¼ï¼Œpipeæ˜¯ä¸€ç§å•å‘çš„æ•°æ®ä¼ è¾“ï¼Œä»ä¸€ç«¯è¾“å…¥ï¼Œä»å¦ä¸€ç«¯è¾“å‡ºã€‚pingpongè¦æ±‚åœ¨çˆ¶å­è¿›ç¨‹ä¸­ä¼ è¾“æ•°æ®ï¼Œå¹¶è¾“å‡ºå„è‡ªpidã€‚æ ¸å¿ƒå°±æ˜¯åˆ©ç”¨pipeå‡½æ•°ä¸¤æ¬¡ï¼Œåˆ©ç”¨forkå‡½æ•°åˆ›å»ºå­è¿›ç¨‹ï¼Œåœ¨çˆ¶å­è¿›ç¨‹ä¸­æ³¨æ„å…³é—­ä¸éœ€è¦çš„è¯»ç«¯å’Œå†™ç«¯ï¼Œç„¶åè¯»å†™pipeã€‚
// user/pingpong.c #include &#34;kernel/types.h&#34; #include &#34;kernel/stat.h&#34; #include &#34;user/user.h&#34; int main(int argc, char* argv[]){ int p1[2], p2[2]; if(pipe(p1) &lt; 0 || pipe(p2) &lt; 0){ printf(&#34;Error: pipe()\n&#34;); exit(1); } int pid; if((pid = fork()) == 0){ close(p1[1]); close(p2[0]); char c; int p = getpid(); read(p1[0], &amp;c, 1); printf(&#34;%d: received ping\n&#34;, p); close(p1[0]); write(p2[1], &amp;c, 1); close(p2[1]); }else{ close(p1[0]); close(p2[1]); int p = getpid(); char c; write(p1[1], &#34;w&#34;, 1); close(p1[1]); read(p2[0], &amp;c, 1); printf(&#34;%d: received pong\n&#34;, p); close(p2[0]); } exit(0); } æ•ˆæœå¦‚å›¾"/>

<meta property="og:title" content="Lab1 Utilities" />
<meta property="og:description" content="Utilitieså®éªŒç›®æ ‡æœ¬å®éªŒä¸»è¦æ˜¯æ¥ç†Ÿæ‚‰xv6å’Œå®ƒçš„ç³»ç»Ÿè°ƒç”¨ï¼Œç³»ç»Ÿè°ƒç”¨æ˜¯ä¸€ç±»ç‰¹æ®Šçš„å‡½æ•°ï¼Œæ˜¯æ“ä½œç³»ç»Ÿæä¾›çš„ä¸€ç±»å¯¹ç‰¹æ®Šèµ„æºçš„è®¿é—®ï¼Œåƒç£ç›˜ï¼ŒIOç­‰ã€‚æœ¬è¯¾ç¨‹æœ‰ä¸€ä¸ªæ ¸å¿ƒå°±æ˜¯ç†è§£ç³»ç»Ÿè°ƒç”¨æ˜¯å¦‚ä½•å®ç°çš„ï¼Œåœ¨åç»­è¯¾ç¨‹å†…å®¹ä¼šåˆè¯¦ç»†ä»‹ç»ã€‚åœ¨å‘½ä»¤è¡Œä¸­æˆ‘ä»¬ç»å¸¸çœ‹åˆ°è®¸å¤šå†…ç½®çš„å‘½ä»¤ä¾‹å¦‚ cd, lsç­‰ï¼Œè¿™äº›å‘½ä»¤å°±æ˜¯åˆ©ç”¨ç³»ç»Ÿè°ƒç”¨å°è£…çš„ç”¨æˆ·çº§ç¨‹åºã€‚labä¼šè¦æ±‚å®ç°å‡ ä¸ªç±»ä¼¼çš„å·¥å…·å‘½ä»¤ã€‚æ€»ä½“æ¥è¯´æœ¬labä¸éš¾ï¼Œä¸»è¦æ˜¯å¯¹xv6çš„ç†Ÿæ‚‰ã€‚
æ¯ä¸ªå®éªŒéƒ½æœ‰ç›¸åº”çš„ä»£ç åˆ†æ”¯ç®¡ç†ï¼Œæ‰€æœ‰åœ¨æ¯ä¸ªå®éªŒéœ€è¦åˆ‡æ¢åˆ°å¯¹åº”åˆ†æ”¯ã€‚åŸºæœ¬æŒ‰ç…§labä¸»é¡µçš„æç¤º(hint)å°±å¯ä»¥å®Œæˆè¯¥å®éªŒï¼Œ
å®éªŒè¯¦è§£Boot xv6 (easy)å¯åŠ¨xv6,è¿è¡Œå†…ç½®çš„lså‘½ä»¤ã€‚
å¾ˆç®€å•ï¼Œåªè¦ç…§ç€åšå°±èƒ½çœ‹åˆ°å¦‚ä¸‹æ•ˆæœã€‚
xv6æ“ä½œç³»ç»Ÿè‡ªå·±å®éªŒäº†ä¸€äº›å¸¸ç”¨çš„å‘½ä»¤ï¼Œåƒcat, ls, echoç­‰ã€‚æ¥ä¸‹æ¥çš„ä»»åŠ¡å°±æ˜¯å®ç°ä¸€äº›ç±»ä¼¼çš„å‘½ä»¤ã€‚
1. sleep (easy)sleep è¦æ±‚åœ¨ç¨‹åºsleepä¸€å°æ®µæ—¶é—´ï¼Œè§£å†³æ–¹æ³•æ˜¯è°ƒç”¨xv6ç³»ç»Ÿæä¾›çš„ç³»ç»Ÿè°ƒç”¨å‡½æ•°ã€‚è¿™é‡Œè¯´ä¸€ä¸‹xv6æºä»£ç ä¸»è¦æœ‰ä¸¤ä¸ªæ–‡ä»¶å¤¹ kernel/ å’Œ user/ã€‚kernelä¸»è¦æ˜¯å†…æ ¸ä»£ç çš„å®ç°ï¼Œuseråˆ™æ˜¯ç”¨æˆ·ç¼–å†™çš„ä»£ç ï¼Œä¾‹å¦‚å‰é¢çš„cat, ls, echoä»¥åŠæˆ‘ä»¬å®ç°çš„sleepç­‰ã€‚å› æ­¤æŒ‰ç…§è¦æ±‚ç¼–å†™ä»£ç  user/sleep.cä»£ç å¦‚ä¸‹
// user/sleep.c #include &#34;kernel/types.h&#34; #include &#34;kernel/stat.h&#34; #include &#34;user/user.h&#34; int main(int argc, char* argv[]){ if(argc != 2){ printf(&#34;Usage: sleep &lt;seconds&gt;\n&#34;); exit(1); } sleep(atoi(argv[1]) * 10); exit(0); } user/user.hå¤´æ–‡ä»¶åŒ…å«äº†xv6æä¾›çš„ç³»ç»Ÿè°ƒç”¨çš„å£°æ˜ï¼Œéœ€è¦åŒ…å«ã€‚
ç¨‹åºçš„è¿”å›xv6ä¸­å¿…é¡»ç”¨exitå‡½æ•°ã€‚
åˆ«å¿˜äº†æ›´æ–°Makefile
ç¼–è¯‘è¿è¡Œï¼Œå¹¶è¾“å…¥sleepå¯ä»¥çœ‹åˆ°å¦‚ä¸‹çš„
pingpong (easy)pipeæ˜¯è¿›ç¨‹é€šä¿¡çš„ä¸€ç§æ–¹å¼ï¼Œpipeæ˜¯ä¸€ç§å•å‘çš„æ•°æ®ä¼ è¾“ï¼Œä»ä¸€ç«¯è¾“å…¥ï¼Œä»å¦ä¸€ç«¯è¾“å‡ºã€‚pingpongè¦æ±‚åœ¨çˆ¶å­è¿›ç¨‹ä¸­ä¼ è¾“æ•°æ®ï¼Œå¹¶è¾“å‡ºå„è‡ªpidã€‚æ ¸å¿ƒå°±æ˜¯åˆ©ç”¨pipeå‡½æ•°ä¸¤æ¬¡ï¼Œåˆ©ç”¨forkå‡½æ•°åˆ›å»ºå­è¿›ç¨‹ï¼Œåœ¨çˆ¶å­è¿›ç¨‹ä¸­æ³¨æ„å…³é—­ä¸éœ€è¦çš„è¯»ç«¯å’Œå†™ç«¯ï¼Œç„¶åè¯»å†™pipeã€‚
// user/pingpong.c #include &#34;kernel/types.h&#34; #include &#34;kernel/stat.h&#34; #include &#34;user/user.h&#34; int main(int argc, char* argv[]){ int p1[2], p2[2]; if(pipe(p1) &lt; 0 || pipe(p2) &lt; 0){ printf(&#34;Error: pipe()\n&#34;); exit(1); } int pid; if((pid = fork()) == 0){ close(p1[1]); close(p2[0]); char c; int p = getpid(); read(p1[0], &amp;c, 1); printf(&#34;%d: received ping\n&#34;, p); close(p1[0]); write(p2[1], &amp;c, 1); close(p2[1]); }else{ close(p1[0]); close(p2[1]); int p = getpid(); char c; write(p1[1], &#34;w&#34;, 1); close(p1[1]); read(p2[0], &amp;c, 1); printf(&#34;%d: received pong\n&#34;, p); close(p2[0]); } exit(0); } æ•ˆæœå¦‚å›¾" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://flash-boy.github.io/posts/6.s081/labs/lab1/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2022-06-05T00:00:00+00:00" />
<meta property="article:modified_time" content="2022-06-05T00:00:00+00:00" />




  <title>Yang Wei</title>

  
  <link rel="canonical" href="https://flash-boy.github.io/posts/6.s081/labs/lab1/">
  

  <link rel="preload" href="../../../../fonts/forkawesome-webfont.woff2?v=1.2.0" as="font" type="font/woff2" crossorigin>


  
  
  <link rel="stylesheet" href="../../../../css/coder.min.6b1a4fbc48955b72aea7913e43fabeb45e8bc120da5aa41b598dd33adcac4b59.css" integrity="sha256-axpPvEiVW3Kup5E&#43;Q/q&#43;tF6LwSDaWqQbWY3TOtysS1k=" crossorigin="anonymous" media="screen" />





  
  
    
    
    <link rel="stylesheet" href="../../../../css/coder-dark.min.39e41a7f16bdf8cb16e43cae7d714fa1016f1d2d2898a5b3f27f42c9979204e2.css" integrity="sha256-OeQafxa9&#43;MsW5DyufXFPoQFvHS0omKWz8n9CyZeSBOI=" crossorigin="anonymous" media="screen" />
  



   




  <link rel="icon" type="image/png" href="../../../../images/favicon-32x32.png" sizes="32x32">
<link rel="icon" type="image/png" href="../../../../images/favicon-16x16.png" sizes="16x16">

<link rel="apple-touch-icon" href="../../../../images/apple-touch-icon.png">
<link rel="apple-touch-icon" sizes="180x180" href="../../../../images/apple-touch-icon.png">

<link rel="manifest" href="../../../../site.webmanifest">
<link rel="mask-icon" href="../../../../images/safari-pinned-tab.svg" color="#5bbad5">


  

  <meta name="generator" content="Hugo 0.100.1" />


  

</head>







<body class="preload-transitions colorscheme-auto">
  
<div class="float-container">
    <a id="dark-mode-toggle" class="colorscheme-toggle">
        <i class="fa fa-adjust fa-fw" aria-hidden="true"></i>
    </a>
</div>


  <main class="wrapper">
    <nav class="navigation">
  <section class="container">
    <a class="navigation-title" href="../../../../">
      Yang Wei
    </a>
    
      <input type="checkbox" id="menu-toggle" />
      <label class="menu-button float-right" for="menu-toggle">
        <i class="fa fa-bars fa-fw" aria-hidden="true"></i>
      </label>
      <ul class="navigation-list">
        
          
            <li class="navigation-item">
              <a class="navigation-link" href="../../../../about/">About</a>
            </li>
          
            <li class="navigation-item">
              <a class="navigation-link" href="../../../../posts/">Blog</a>
            </li>
          
            <li class="navigation-item">
              <a class="navigation-link" href="../../../../projects/">Projects</a>
            </li>
          
            <li class="navigation-item">
              <a class="navigation-link" href="../../../../contact/">Contact me</a>
            </li>
          
        
        
      </ul>
    
  </section>
</nav>


    <div class="content">
      
  <section class="container post">
    <article>
      <header>
        <div class="post-title">
          <h1 class="title">
            <a class="title-link" href="https://flash-boy.github.io/posts/6.s081/labs/lab1/">
              Lab1 Utilities
            </a>
          </h1>
        </div>
        <div class="post-meta">
          <div class="date">
            <span class="posted-on">
              <i class="fa fa-calendar" aria-hidden="true"></i>
              <time datetime="2022-06-05T00:00:00Z">
                June 5, 2022
              </time>
            </span>
            <span class="reading-time">
              <i class="fa fa-clock-o" aria-hidden="true"></i>
              3-minute read
            </span>
          </div>
          
          <div class="categories">
  <i class="fa fa-folder" aria-hidden="true"></i>
    <a href="../../../../categories/operator-system/">Operator System</a></div>

          <div class="tags">
  <i class="fa fa-tag" aria-hidden="true"></i>
    <span class="tag">
      <a href="../../../../tags/c/">C</a>
    </span>
      <span class="separator">â€¢</span>
    <span class="tag">
      <a href="../../../../tags/course/">Course</a>
    </span>
      <span class="separator">â€¢</span>
    <span class="tag">
      <a href="../../../../tags/mit/">MIT</a>
    </span></div>

        </div>
      </header>

      <div>
        
        <h1 id="utilitieshttpspdoscsailmitedu68282020labsutilhtml">
  <a href="https://pdos.csail.mit.edu/6.828/2020/labs/util.html">Utilities</a>
  <a class="heading-link" href="#utilitieshttpspdoscsailmitedu68282020labsutilhtml">
    <i class="fa fa-link" aria-hidden="true"></i>
  </a>
</h1>
<h2 id="å®éªŒç›®æ ‡">
  å®éªŒç›®æ ‡
  <a class="heading-link" href="#%e5%ae%9e%e9%aa%8c%e7%9b%ae%e6%a0%87">
    <i class="fa fa-link" aria-hidden="true"></i>
  </a>
</h2>
<hr>
<p>æœ¬å®éªŒä¸»è¦æ˜¯æ¥ç†Ÿæ‚‰xv6å’Œå®ƒçš„ç³»ç»Ÿè°ƒç”¨ï¼Œç³»ç»Ÿè°ƒç”¨æ˜¯ä¸€ç±»ç‰¹æ®Šçš„å‡½æ•°ï¼Œæ˜¯æ“ä½œç³»ç»Ÿæä¾›çš„ä¸€ç±»å¯¹ç‰¹æ®Šèµ„æºçš„è®¿é—®ï¼Œåƒç£ç›˜ï¼ŒIOç­‰ã€‚æœ¬è¯¾ç¨‹æœ‰ä¸€ä¸ªæ ¸å¿ƒå°±æ˜¯ç†è§£ç³»ç»Ÿè°ƒç”¨æ˜¯å¦‚ä½•å®ç°çš„ï¼Œåœ¨åç»­è¯¾ç¨‹å†…å®¹ä¼šåˆè¯¦ç»†ä»‹ç»ã€‚åœ¨å‘½ä»¤è¡Œä¸­æˆ‘ä»¬ç»å¸¸çœ‹åˆ°è®¸å¤šå†…ç½®çš„å‘½ä»¤ä¾‹å¦‚ <strong>cd</strong>, <strong>ls</strong>ç­‰ï¼Œè¿™äº›å‘½ä»¤å°±æ˜¯åˆ©ç”¨ç³»ç»Ÿè°ƒç”¨å°è£…çš„ç”¨æˆ·çº§ç¨‹åºã€‚labä¼šè¦æ±‚å®ç°å‡ ä¸ªç±»ä¼¼çš„å·¥å…·å‘½ä»¤ã€‚æ€»ä½“æ¥è¯´æœ¬labä¸éš¾ï¼Œä¸»è¦æ˜¯å¯¹xv6çš„ç†Ÿæ‚‰ã€‚</p>
<p>æ¯ä¸ªå®éªŒéƒ½æœ‰ç›¸åº”çš„ä»£ç åˆ†æ”¯ç®¡ç†ï¼Œæ‰€æœ‰åœ¨æ¯ä¸ªå®éªŒéœ€è¦åˆ‡æ¢åˆ°å¯¹åº”åˆ†æ”¯ã€‚åŸºæœ¬æŒ‰ç…§labä¸»é¡µçš„æç¤º(hint)å°±å¯ä»¥å®Œæˆè¯¥å®éªŒï¼Œ</p>
<h2 id="å®éªŒè¯¦è§£">
  å®éªŒè¯¦è§£
  <a class="heading-link" href="#%e5%ae%9e%e9%aa%8c%e8%af%a6%e8%a7%a3">
    <i class="fa fa-link" aria-hidden="true"></i>
  </a>
</h2>
<hr>
<h3 id="boot-xv6-easy">
  Boot xv6 (easy)
  <a class="heading-link" href="#boot-xv6-easy">
    <i class="fa fa-link" aria-hidden="true"></i>
  </a>
</h3>
<p>å¯åŠ¨xv6,è¿è¡Œå†…ç½®çš„lså‘½ä»¤ã€‚<br>
å¾ˆç®€å•ï¼Œåªè¦ç…§ç€åšå°±èƒ½çœ‹åˆ°å¦‚ä¸‹æ•ˆæœã€‚</p>
<p><img src="https://raw.githubusercontent.com/Flash-boy/PicGo/master/6.S081/lab1-1.png" alt=""></p>
<p>xv6æ“ä½œç³»ç»Ÿè‡ªå·±å®éªŒäº†ä¸€äº›å¸¸ç”¨çš„å‘½ä»¤ï¼Œåƒcat, ls, echoç­‰ã€‚æ¥ä¸‹æ¥çš„ä»»åŠ¡å°±æ˜¯å®ç°ä¸€äº›ç±»ä¼¼çš„å‘½ä»¤ã€‚</p>
<h3 id="1-sleep-easy">
  1. sleep (easy)
  <a class="heading-link" href="#1-sleep-easy">
    <i class="fa fa-link" aria-hidden="true"></i>
  </a>
</h3>
<p>sleep è¦æ±‚åœ¨ç¨‹åºsleepä¸€å°æ®µæ—¶é—´ï¼Œè§£å†³æ–¹æ³•æ˜¯è°ƒç”¨xv6ç³»ç»Ÿæä¾›çš„ç³»ç»Ÿè°ƒç”¨å‡½æ•°ã€‚è¿™é‡Œè¯´ä¸€ä¸‹xv6æºä»£ç ä¸»è¦æœ‰ä¸¤ä¸ªæ–‡ä»¶å¤¹ kernel/ å’Œ user/ã€‚kernelä¸»è¦æ˜¯å†…æ ¸ä»£ç çš„å®ç°ï¼Œuseråˆ™æ˜¯ç”¨æˆ·ç¼–å†™çš„ä»£ç ï¼Œä¾‹å¦‚å‰é¢çš„cat, ls, echoä»¥åŠæˆ‘ä»¬å®ç°çš„sleepç­‰ã€‚å› æ­¤æŒ‰ç…§è¦æ±‚ç¼–å†™ä»£ç  user/sleep.cä»£ç å¦‚ä¸‹</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c" data-lang="c"><span style="display:flex;"><span><span style="font-style:italic">// user/sleep.c
</span></span></span><span style="display:flex;"><span><span style="font-style:italic"></span><span style="">#include</span> <span style="">&#34;kernel/types.h&#34;</span><span style="">
</span></span></span><span style="display:flex;"><span><span style="">#include</span> <span style="">&#34;kernel/stat.h&#34;</span><span style="">
</span></span></span><span style="display:flex;"><span><span style="">#include</span> <span style="">&#34;user/user.h&#34;</span><span style="">
</span></span></span><span style="display:flex;"><span><span style=""></span>
</span></span><span style="display:flex;"><span><span style="">int</span> main(<span style="">int</span> argc, <span style="">char</span>* argv[]){
</span></span><span style="display:flex;"><span>    <span style="font-weight:bold">if</span>(argc != 2){
</span></span><span style="display:flex;"><span>        printf(<span style="font-style:italic">&#34;Usage: sleep &lt;seconds&gt;</span><span style="font-weight:bold;font-style:italic">\n</span><span style="font-style:italic">&#34;</span>);
</span></span><span style="display:flex;"><span>        exit(1);
</span></span><span style="display:flex;"><span>    }    
</span></span><span style="display:flex;"><span>    sleep(atoi(argv[1]) * 10);
</span></span><span style="display:flex;"><span>    exit(0);
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>user/user.hå¤´æ–‡ä»¶åŒ…å«äº†xv6æä¾›çš„ç³»ç»Ÿè°ƒç”¨çš„å£°æ˜ï¼Œéœ€è¦åŒ…å«ã€‚</p>
<p>ç¨‹åºçš„è¿”å›xv6ä¸­å¿…é¡»ç”¨exitå‡½æ•°ã€‚</p>
<p>åˆ«å¿˜äº†æ›´æ–°Makefile</p>
<p>ç¼–è¯‘è¿è¡Œï¼Œå¹¶è¾“å…¥sleepå¯ä»¥çœ‹åˆ°å¦‚ä¸‹çš„</p>
<p><img src="https://raw.githubusercontent.com/Flash-boy/PicGo/master/6.S081/lab1-2.png" alt=""></p>
<h3 id="pingpong-easy">
  pingpong (easy)
  <a class="heading-link" href="#pingpong-easy">
    <i class="fa fa-link" aria-hidden="true"></i>
  </a>
</h3>
<p>pipeæ˜¯è¿›ç¨‹é€šä¿¡çš„ä¸€ç§æ–¹å¼ï¼Œpipeæ˜¯ä¸€ç§å•å‘çš„æ•°æ®ä¼ è¾“ï¼Œä»ä¸€ç«¯è¾“å…¥ï¼Œä»å¦ä¸€ç«¯è¾“å‡ºã€‚pingpongè¦æ±‚åœ¨çˆ¶å­è¿›ç¨‹ä¸­ä¼ è¾“æ•°æ®ï¼Œå¹¶è¾“å‡ºå„è‡ªpidã€‚æ ¸å¿ƒå°±æ˜¯åˆ©ç”¨pipeå‡½æ•°ä¸¤æ¬¡ï¼Œåˆ©ç”¨forkå‡½æ•°åˆ›å»ºå­è¿›ç¨‹ï¼Œåœ¨çˆ¶å­è¿›ç¨‹ä¸­æ³¨æ„å…³é—­ä¸éœ€è¦çš„è¯»ç«¯å’Œå†™ç«¯ï¼Œç„¶åè¯»å†™pipeã€‚</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c" data-lang="c"><span style="display:flex;"><span><span style="font-style:italic">// user/pingpong.c
</span></span></span><span style="display:flex;"><span><span style="font-style:italic"></span><span style="">#include</span> <span style="">&#34;kernel/types.h&#34;</span><span style="">
</span></span></span><span style="display:flex;"><span><span style="">#include</span> <span style="">&#34;kernel/stat.h&#34;</span><span style="">
</span></span></span><span style="display:flex;"><span><span style="">#include</span> <span style="">&#34;user/user.h&#34;</span><span style="">
</span></span></span><span style="display:flex;"><span><span style=""></span>
</span></span><span style="display:flex;"><span><span style="">int</span> main(<span style="">int</span> argc, <span style="">char</span>* argv[]){
</span></span><span style="display:flex;"><span>    <span style="">int</span> p1[2], p2[2];
</span></span><span style="display:flex;"><span>    <span style="font-weight:bold">if</span>(pipe(p1) &lt; 0 || pipe(p2) &lt; 0){
</span></span><span style="display:flex;"><span>        printf(<span style="font-style:italic">&#34;Error: pipe()</span><span style="font-weight:bold;font-style:italic">\n</span><span style="font-style:italic">&#34;</span>);
</span></span><span style="display:flex;"><span>        exit(1);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    <span style="">int</span> pid;
</span></span><span style="display:flex;"><span>    <span style="font-weight:bold">if</span>((pid = fork()) == 0){
</span></span><span style="display:flex;"><span>        close(p1[1]); 
</span></span><span style="display:flex;"><span>        close(p2[0]);
</span></span><span style="display:flex;"><span>        <span style="">char</span> c;
</span></span><span style="display:flex;"><span>        <span style="">int</span> p = getpid();
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        read(p1[0], &amp;c, 1);
</span></span><span style="display:flex;"><span>        printf(<span style="font-style:italic">&#34;%d: received ping</span><span style="font-weight:bold;font-style:italic">\n</span><span style="font-style:italic">&#34;</span>, p);
</span></span><span style="display:flex;"><span>        close(p1[0]);
</span></span><span style="display:flex;"><span>        write(p2[1], &amp;c, 1);
</span></span><span style="display:flex;"><span>        close(p2[1]);
</span></span><span style="display:flex;"><span>    }<span style="font-weight:bold">else</span>{
</span></span><span style="display:flex;"><span>        close(p1[0]);
</span></span><span style="display:flex;"><span>        close(p2[1]);
</span></span><span style="display:flex;"><span>        <span style="">int</span> p = getpid();
</span></span><span style="display:flex;"><span>        <span style="">char</span> c;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        write(p1[1], <span style="font-style:italic">&#34;w&#34;</span>, 1); 
</span></span><span style="display:flex;"><span>        close(p1[1]);
</span></span><span style="display:flex;"><span>        read(p2[0], &amp;c, 1);
</span></span><span style="display:flex;"><span>        printf(<span style="font-style:italic">&#34;%d: received pong</span><span style="font-weight:bold;font-style:italic">\n</span><span style="font-style:italic">&#34;</span>, p);
</span></span><span style="display:flex;"><span>        close(p2[0]);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    exit(0);
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>æ•ˆæœå¦‚å›¾<br>
<img src="https://raw.githubusercontent.com/Flash-boy/PicGo/master/6.S081/lab1-3.png" alt=""></p>
<h3 id="primes-moderatehard">
  primes (moderate/hard)
  <a class="heading-link" href="#primes-moderatehard">
    <i class="fa fa-link" aria-hidden="true"></i>
  </a>
</h3>
<p>primesç¨‹åºè¦æ±‚å¹¶è¡Œçš„è¾“å‡ºä¸€è¿ä¸²è‡ªç„¶æ•°ä¸­æ˜¯è´¨æ•°çš„æ•°æ®ï¼Œæ ¸å¿ƒæ˜¯åˆ©ç”¨pipeå’Œforkå‡½æ•°ï¼Œä¸€ä¸ªå¾ˆå·§å¦™çš„ç®—æ³•æ­¥éª¤æ˜¯</p>
<ol>
<li>ä»çˆ¶è¿›ç¨‹è¯»å–æ•°æ®ï¼Œå¦‚æœæ²¡æœ‰æ•°æ®å¯è¯»ï¼Œè¿”å›ï¼›è‹¥æœ‰åˆ™è¯»å–åˆ°çš„ç¬¬ä¸€ä¸ªæ•°ä¸€å®šæ˜¯è´¨æ•°ï¼Œè®°ä½œnå¹¶è¾“å‡ºã€‚</li>
<li>ç»§ç»­ä»çˆ¶è¿›ç¨‹è¯»å–æ•°æ®ï¼Œåˆ¤æ–­è¯¥æ•°æ˜¯ä¸æ˜¯nçš„å€æ•°ï¼Œè‹¥æ˜¯åˆ™å¿½ç•¥ï¼Œè‹¥ä¸æ˜¯åˆ™å†™è¯¥æ•°æ®åˆ°å­è¿›ç¨‹ã€‚</li>
</ol>
<p><strong>æ³¨æ„å…³é—­ä¸éœ€è¦çš„è¯»ç«¯æˆ–å†™ç«¯</strong>ã€‚æƒ³è±¡ä¸€ä¸‹å¦‚æœç³»ç»Ÿæ”¯æŒå¤šæ ¸ï¼Œæ˜¯ä¸æ˜¯èƒ½å¤Ÿåšåˆ°å¹¶è¡Œ ğŸ˜„</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c" data-lang="c"><span style="display:flex;"><span><span style="font-style:italic">// user/primes.c
</span></span></span><span style="display:flex;"><span><span style="font-style:italic"></span><span style="">#include</span> <span style="">&#34;kernel/types.h&#34;</span><span style="">
</span></span></span><span style="display:flex;"><span><span style="">#include</span> <span style="">&#34;kernel/stat.h&#34;</span><span style="">
</span></span></span><span style="display:flex;"><span><span style="">#include</span> <span style="">&#34;user/user.h&#34;</span><span style="">
</span></span></span><span style="display:flex;"><span><span style=""></span>
</span></span><span style="display:flex;"><span><span style="">void</span> prime(<span style="">int</span> p[2]){
</span></span><span style="display:flex;"><span>    close(p[1]); <span style="font-style:italic">//å­è¿›ç¨‹å…³é—­å†™ç«¯
</span></span></span><span style="display:flex;"><span><span style="font-style:italic"></span>    <span style="">int</span> n;
</span></span><span style="display:flex;"><span>    <span style="font-style:italic">// å¦‚æœæ²¡æœ‰æ•°æ®å¯è¯»å…³é—­è¯»ç«¯
</span></span></span><span style="display:flex;"><span><span style="font-style:italic"></span>    <span style="font-weight:bold">if</span>(read(p[0], &amp;n, <span style="font-weight:bold">sizeof</span>(n)) == 0){
</span></span><span style="display:flex;"><span>        close(p[0]);
</span></span><span style="display:flex;"><span>        exit(0);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    printf(<span style="font-style:italic">&#34;prime %d</span><span style="font-weight:bold;font-style:italic">\n</span><span style="font-style:italic">&#34;</span>, n);
</span></span><span style="display:flex;"><span>    <span style="">int</span> num;
</span></span><span style="display:flex;"><span>    <span style="">int</span> p1[2]; pipe(p1);
</span></span><span style="display:flex;"><span>    <span style="">int</span> pid = fork();
</span></span><span style="display:flex;"><span>    <span style="font-weight:bold">if</span>(pid == 0){
</span></span><span style="display:flex;"><span>        prime(p1);
</span></span><span style="display:flex;"><span>    }<span style="font-weight:bold">else</span> <span style="font-weight:bold">if</span>(pid &gt; 0){
</span></span><span style="display:flex;"><span>       close(p1[0]); 
</span></span><span style="display:flex;"><span>       <span style="font-style:italic">// ä»çˆ¶è¿›ç¨‹è¯»å–æ•°æ®ï¼Œå°†å½“å‰ä¸æ˜¯è´¨æ•°å€æ•°çš„ä¼ é€’ç»™å­è¿›ç¨‹
</span></span></span><span style="display:flex;"><span><span style="font-style:italic"></span>       <span style="font-weight:bold">while</span>(read(p[0], &amp;num, <span style="font-weight:bold">sizeof</span>(num))){
</span></span><span style="display:flex;"><span>           <span style="font-weight:bold">if</span>(num % n != 0){
</span></span><span style="display:flex;"><span>               write(p1[1], &amp;num, <span style="font-weight:bold">sizeof</span>(num));
</span></span><span style="display:flex;"><span>           }
</span></span><span style="display:flex;"><span>       }
</span></span><span style="display:flex;"><span>       close(p); <span style="font-style:italic">//å…³é—­ä»çˆ¶è¿›ç¨‹è¯»å–çš„è¯»ç«¯
</span></span></span><span style="display:flex;"><span><span style="font-style:italic"></span>       close(p1[1]); <span style="font-style:italic">//å…³é—­å‘å­è¿›ç¨‹å†™æ•°æ®çš„å†™ç«¯
</span></span></span><span style="display:flex;"><span><span style="font-style:italic"></span>       wait(0);
</span></span><span style="display:flex;"><span>       exit(0);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    exit(1);
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span><span style="">int</span> main(<span style="">int</span> argc, <span style="">char</span>* argv[]){
</span></span><span style="display:flex;"><span>    <span style="">int</span> p[2];
</span></span><span style="display:flex;"><span>    pipe(p); 
</span></span><span style="display:flex;"><span>    <span style="">int</span> pid = fork();
</span></span><span style="display:flex;"><span>    <span style="font-weight:bold">if</span>(pid == 0){
</span></span><span style="display:flex;"><span>        <span style="font-style:italic">// å­è¿›ç¨‹å¤„ç†æ•°æ®
</span></span></span><span style="display:flex;"><span><span style="font-style:italic"></span>        prime(p);
</span></span><span style="display:flex;"><span>    }<span style="font-weight:bold">else</span> <span style="font-weight:bold">if</span>(pid &gt; 0){
</span></span><span style="display:flex;"><span>        <span style="font-style:italic">// çˆ¶è¿›ç¨‹ä¼ è¾“ç­›é€‰çš„æ•°æ®ç»™å­è¿›ç¨‹
</span></span></span><span style="display:flex;"><span><span style="font-style:italic"></span>        close(p[0]); <span style="font-style:italic">// çˆ¶è¿›ç¨‹å…³é—­è¯»ç«¯
</span></span></span><span style="display:flex;"><span><span style="font-style:italic"></span>        <span style="font-weight:bold">for</span>(<span style="">int</span> i = 2; i &lt;= 35; ++i){
</span></span><span style="display:flex;"><span>            write(p[1], &amp;i, <span style="font-weight:bold">sizeof</span>(i)); 
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>        close(p[1]);<span style="font-style:italic">// å…³é—­å†™ç«¯ï¼Œå¯ä»¥è®©è¯»ç«¯readè¿”å›0
</span></span></span><span style="display:flex;"><span><span style="font-style:italic"></span>        wait(0);<span style="font-style:italic">// ç­‰å¾…å­è¿›ç¨‹è¿è¡Œç»“æŸ
</span></span></span><span style="display:flex;"><span><span style="font-style:italic"></span>        exit(0);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    exit(1);
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>æ•ˆæœå¦‚å›¾<br>
<img src="https://raw.githubusercontent.com/Flash-boy/PicGo/master/6.S081/lab1-4.png" alt=""></p>
<h3 id="find-moderate">
  find (moderate)
  <a class="heading-link" href="#find-moderate">
    <i class="fa fa-link" aria-hidden="true"></i>
  </a>
</h3>
<p>findå‘½ä»¤è¦æ±‚é€’å½’æŸ¥æ‰¾æŸä¸ªç›®å½•ä¸‹æ˜¯å¦å…·æœ‰æŸä¸ªæ–‡ä»¶ï¼Œæ ¸å¿ƒæ˜¯åˆ©ç”¨fstateå‡½æ•°è¯»å–æŸä¸ªæ–‡ä»¶æˆ–è€…ç›®å½•ï¼Œå¦‚æœæ˜¯æ–‡ä»¶ï¼Œåˆ¤æ–­æ–‡ä»¶åæ˜¯å¦ç¬¦åˆè¦æ±‚ï¼Œå¦åˆ™ï¼Œé€’å½’æŸ¥æ‰¾ã€‚</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c" data-lang="c"><span style="display:flex;"><span><span style="font-style:italic">// user/find.c
</span></span></span><span style="display:flex;"><span><span style="font-style:italic"></span><span style="">#include</span> <span style="">&#34;kernel/types.h&#34;</span><span style="">
</span></span></span><span style="display:flex;"><span><span style="">#include</span> <span style="">&#34;kernel/stat.h&#34;</span><span style="">
</span></span></span><span style="display:flex;"><span><span style="">#include</span> <span style="">&#34;user/user.h&#34;</span><span style="">
</span></span></span><span style="display:flex;"><span><span style="">#include</span> <span style="">&#34;kernel/fs.h&#34;</span><span style="">
</span></span></span><span style="display:flex;"><span><span style=""></span>
</span></span><span style="display:flex;"><span><span style="font-style:italic">// è¿”å›æ–‡ä»¶è·¯å¾„ä¸­æœ€åä¸€ä¸ª/åçš„å­—ç¬¦ä¸²
</span></span></span><span style="display:flex;"><span><span style="font-style:italic"></span><span style="">char</span>* fmtname(<span style="">char</span> *path){
</span></span><span style="display:flex;"><span>    <span style="">char</span> *p;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="font-style:italic">// Find first character after last slash.
</span></span></span><span style="display:flex;"><span><span style="font-style:italic"></span>    <span style="font-weight:bold">for</span>(p=path+strlen(path); p &gt;= path &amp;&amp; *p != <span style="font-style:italic">&#39;/&#39;</span>; p--)
</span></span><span style="display:flex;"><span>        ;
</span></span><span style="display:flex;"><span>    p++;
</span></span><span style="display:flex;"><span>    <span style="font-weight:bold">return</span> p;
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="">void</span> find(<span style="">char</span>* path, <span style="">char</span>* filename){
</span></span><span style="display:flex;"><span>    <span style="">char</span> buf[512], *p;
</span></span><span style="display:flex;"><span>    <span style="">int</span> fd;
</span></span><span style="display:flex;"><span>    <span style="font-weight:bold">struct</span> dirent de;
</span></span><span style="display:flex;"><span>    <span style="font-weight:bold">struct</span> stat st;
</span></span><span style="display:flex;"><span>    <span style="font-weight:bold">if</span>((fd = open(path, 0)) &lt; 0){
</span></span><span style="display:flex;"><span>        fprintf(2, <span style="font-style:italic">&#34;find: cannot open %s</span><span style="font-weight:bold;font-style:italic">\n</span><span style="font-style:italic">&#34;</span>, path);
</span></span><span style="display:flex;"><span>        <span style="font-weight:bold">return</span>;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    <span style="font-weight:bold">if</span>(fstat(fd, &amp;st) &lt; 0){
</span></span><span style="display:flex;"><span>        fprintf(2, <span style="font-style:italic">&#34;find: cannot stat %s</span><span style="font-weight:bold;font-style:italic">\n</span><span style="font-style:italic">&#34;</span>, path);
</span></span><span style="display:flex;"><span>        close(fd);
</span></span><span style="display:flex;"><span>        <span style="font-weight:bold">return</span>;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="font-weight:bold">switch</span>(st.type){
</span></span><span style="display:flex;"><span>        <span style="font-weight:bold">case</span> T_FILE: <span style="font-style:italic">// å½“å‰pathæ˜¯æ–‡ä»¶ï¼Œåˆ¤æ–­æ˜¯å¦ç¬¦åˆè¦æ±‚
</span></span></span><span style="display:flex;"><span><span style="font-style:italic"></span>            <span style="font-weight:bold">if</span>(strcmp(fmtname(filename), fmtname(path)) == 0){
</span></span><span style="display:flex;"><span>                printf(<span style="font-style:italic">&#34;%s</span><span style="font-weight:bold;font-style:italic">\n</span><span style="font-style:italic">&#34;</span>, path);
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>            <span style="font-weight:bold">break</span>;
</span></span><span style="display:flex;"><span>        <span style="font-weight:bold">case</span> T_DIR:  <span style="font-style:italic">// å¦‚æœå½“å‰pathæ˜¯ç›®å½•ï¼Œåˆ™è¯»å–ç›®å‰ä¸­æ¯ä¸€ä¸ªæ¡ç›®
</span></span></span><span style="display:flex;"><span><span style="font-style:italic"></span>            <span style="font-weight:bold">if</span>(strlen(path) + 1 + DIRSIZ + 1 &gt; <span style="font-weight:bold">sizeof</span>(buf)){
</span></span><span style="display:flex;"><span>                printf(<span style="font-style:italic">&#34;find: path too long</span><span style="font-weight:bold;font-style:italic">\n</span><span style="font-style:italic">&#34;</span>);
</span></span><span style="display:flex;"><span>                <span style="font-weight:bold">break</span>;
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>            strcpy(buf, path);
</span></span><span style="display:flex;"><span>            p = buf + strlen(buf);
</span></span><span style="display:flex;"><span>            *p++ = <span style="font-style:italic">&#39;/&#39;</span>;
</span></span><span style="display:flex;"><span>            <span style="font-weight:bold">while</span>(read(fd, &amp;de, <span style="font-weight:bold">sizeof</span>(de)) == <span style="font-weight:bold">sizeof</span>(de)){
</span></span><span style="display:flex;"><span>                <span style="font-style:italic">// . å’Œ .. éœ€è¦å‰”é™¤ï¼Œé¿å…é€’å½’æ­»å¾ªç¯
</span></span></span><span style="display:flex;"><span><span style="font-style:italic"></span>                <span style="font-weight:bold">if</span>(de.inum == 0 || strcmp(de.name, <span style="font-style:italic">&#34;.&#34;</span>) == 0 || strcmp(de.name, <span style="font-style:italic">&#34;..&#34;</span>) == 0)
</span></span><span style="display:flex;"><span>                    <span style="font-weight:bold">continue</span>;
</span></span><span style="display:flex;"><span>                strcpy(p, de.name); <span style="font-style:italic">// æ›´æ–°è·¯å¾„
</span></span></span><span style="display:flex;"><span><span style="font-style:italic"></span>                find(buf, filename);<span style="font-style:italic">// é€’å½’æŸ¥è¯¢
</span></span></span><span style="display:flex;"><span><span style="font-style:italic"></span>            }        
</span></span><span style="display:flex;"><span>            <span style="font-weight:bold">break</span>;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    close(fd);
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span><span style="">int</span> main(<span style="">int</span> argc, <span style="">char</span>* argv[]){
</span></span><span style="display:flex;"><span>    <span style="font-weight:bold">if</span>(argc == 2){
</span></span><span style="display:flex;"><span>        find(<span style="font-style:italic">&#34;.&#34;</span>, argv[1]);
</span></span><span style="display:flex;"><span>    }<span style="font-weight:bold">else</span> <span style="font-weight:bold">if</span>(argc == 3){
</span></span><span style="display:flex;"><span>        find(argv[1], argv[2]);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    exit(0);
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>æ•ˆæœå¦‚å›¾
<img src="https://raw.githubusercontent.com/Flash-boy/PicGo/master/6.S081/lab1-5.png" alt=""></p>
<h3 id="xargs-moderate">
  xargs (moderate)
  <a class="heading-link" href="#xargs-moderate">
    <i class="fa fa-link" aria-hidden="true"></i>
  </a>
</h3>
<p>xargså‘½ä»¤æ˜¯unixä¸‹ä¸€ä¸ªååˆ†æœ‰ç”¨çš„å‘½ä»¤ï¼Œå®ƒå¯ä»¥æŠŠè¾“å…¥çš„æ•°æ®æ‰¹é‡è½¬æ¢ä¸ºè¦æ‰§è¡Œçš„å‘½ä»¤çš„å‚æ•°ã€‚æ ¸å¿ƒå°±æ˜¯æŒ‰è¡Œæ‰¹é‡å¤„ç†è¾“å…¥æ•°æ®ï¼Œç„¶ååˆ©ç”¨execå‡½æ•°æ‰§è¡Œã€‚</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c" data-lang="c"><span style="display:flex;"><span><span style="font-style:italic">// user/xargs.c
</span></span></span><span style="display:flex;"><span><span style="font-style:italic"></span><span style="">#include</span> <span style="">&#34;kernel/types.h&#34;</span><span style="">
</span></span></span><span style="display:flex;"><span><span style="">#include</span> <span style="">&#34;kernel/stat.h&#34;</span><span style="">
</span></span></span><span style="display:flex;"><span><span style="">#include</span> <span style="">&#34;kernel/param.h&#34;</span><span style="">
</span></span></span><span style="display:flex;"><span><span style="">#include</span> <span style="">&#34;user/user.h&#34;</span><span style="">
</span></span></span><span style="display:flex;"><span><span style=""></span>
</span></span><span style="display:flex;"><span><span style="">int</span> main(<span style="">int</span> argc, <span style="">char</span>* argv[]){
</span></span><span style="display:flex;"><span>    <span style="">char</span>* args[MAXARG];
</span></span><span style="display:flex;"><span>    <span style="">char</span> line[1024];
</span></span><span style="display:flex;"><span>    <span style="font-weight:bold">if</span>(argc == 1){
</span></span><span style="display:flex;"><span>        args[0] = <span style="font-style:italic">&#34;echo&#34;</span>;
</span></span><span style="display:flex;"><span>    }<span style="font-weight:bold">else</span>{
</span></span><span style="display:flex;"><span>        args[0] = argv[1];
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    <span style="">char</span>* cmd = args[0];
</span></span><span style="display:flex;"><span>    <span style="">int</span> x = 1;
</span></span><span style="display:flex;"><span>    <span style="font-weight:bold">for</span>(<span style="">int</span> i = 2; i &lt; argc; ++i){
</span></span><span style="display:flex;"><span>        args[x++] = argv[i];
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    <span style="font-style:italic">// read a line one time
</span></span></span><span style="display:flex;"><span><span style="font-style:italic"></span>    <span style="">int</span> n;
</span></span><span style="display:flex;"><span>    <span style="font-weight:bold">while</span>((n = read(0, line, 1024)) &gt; 0){
</span></span><span style="display:flex;"><span>        <span style="font-weight:bold">if</span>(fork() == 0){
</span></span><span style="display:flex;"><span>            <span style="font-style:italic">// å­è¿›ç¨‹è§£æè¡Œå¹¶è°ƒç”¨execæ‰§è¡Œå‘½ä»¤
</span></span></span><span style="display:flex;"><span><span style="font-style:italic"></span>           <span style="">int</span> index = x;
</span></span><span style="display:flex;"><span>           <span style="">char</span>* arg = line;
</span></span><span style="display:flex;"><span>           <span style="font-style:italic">// printf(&#34;line: [%s]\n&#34;, line);
</span></span></span><span style="display:flex;"><span><span style="font-style:italic"></span>           <span style="font-weight:bold">for</span>(<span style="">int</span> i = 0; i &lt; n; ++i){
</span></span><span style="display:flex;"><span>               <span style="font-weight:bold">if</span>(line[i] == <span style="font-style:italic">&#39; &#39;</span> || line[i] == <span style="font-style:italic">&#39;\n&#39;</span>){
</span></span><span style="display:flex;"><span>                   line[i] = 0;
</span></span><span style="display:flex;"><span>                   args[index++] = arg;
</span></span><span style="display:flex;"><span>                   arg = line + i + 1;
</span></span><span style="display:flex;"><span>               }
</span></span><span style="display:flex;"><span>           } 
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>           args[index] = 0;
</span></span><span style="display:flex;"><span>           exec(cmd, args);
</span></span><span style="display:flex;"><span>        }<span style="font-weight:bold">else</span>{
</span></span><span style="display:flex;"><span>            <span style="font-style:italic">// çˆ¶è¿›ç¨‹ç­‰å¾…å­è¿›ç¨‹æ‰§è¡Œå®Œæ¯•
</span></span></span><span style="display:flex;"><span><span style="font-style:italic"></span>            wait(0);
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    exit(0);
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>æ•ˆæœå¦‚å›¾
<img src="https://raw.githubusercontent.com/Flash-boy/PicGo/master/6.S081/lab1-6.png" alt=""></p>
<h2 id="å®éªŒæ€»ç»“">
  å®éªŒæ€»ç»“
  <a class="heading-link" href="#%e5%ae%9e%e9%aa%8c%e6%80%bb%e7%bb%93">
    <i class="fa fa-link" aria-hidden="true"></i>
  </a>
</h2>
<hr>
<p>æ€»ä½“æ¥è¯´è¯¥labä¸éš¾ï¼Œä¸»è¦æ˜¯ç†Ÿæ‚‰ä¸€äº›åŸºæœ¬çš„æ¦‚å¿µ,ä¸»è¦ç†Ÿæ‚‰ç³»ç»Ÿè°ƒç”¨ï¼Œåƒpipe, fork, fstat, execç­‰ã€‚æœ€æœ‰è¶£çš„æ˜¯primesï¼Œé€šè¿‡åˆ©ç”¨forkå’Œç®¡é“ï¼Œå®ç°äº†æ•°æ®çš„æµæ°´çº¿å¹¶è¡Œå¤„ç†ã€‚</p>
<p>æœ€åè¿è¡Œ make gradeå¯ ä»¥å¾—åˆ°è¯¥labçš„æ‰€æœ‰æµ‹è¯•å¦‚å›¾
<img src="https://raw.githubusercontent.com/Flash-boy/PicGo/master/6.S081/lab1-7.png" alt=""></p>

      </div>


      <footer>
        


        
        
        
      </footer>
    </article>

    
  </section>

    </div>

    <footer class="footer">
  <section class="container">
    Â©
    
      2019 -
    
    2022
     Yang Wei 
    Â·
    
    Powered by <a href="https://gohugo.io/">Hugo</a> & <a href="https://github.com/luizdepra/hugo-coder/">Coder</a>.
    
  </section>
</footer>

  </main>

  
  
  <script src="../../../../js/coder.min.f411a1043e37c7c14dfb03f4d94d60d9ee69cfa413b16d0fd4f28695babb82bb.js" integrity="sha256-9BGhBD43x8FN&#43;wP02U1g2e5pz6QTsW0P1PKGlbq7grs="></script>
  

  

  

  

  

  

  

  

  
</body>

</html>
